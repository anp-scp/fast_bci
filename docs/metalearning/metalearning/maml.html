<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>metalearning.maml API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../metalearning.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;metalearning</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#MAMLModel">MAMLModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MAMLModel.__init__">MAMLModel</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLModel.vars">vars</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLModel.vars_bn">vars_bn</a>
                        </li>
                        <li>
                                <a class="function" href="#MAMLModel.forward">forward</a>
                        </li>
                        <li>
                                <a class="function" href="#MAMLModel.extra_repr">extra_repr</a>
                        </li>
                        <li>
                                <a class="function" href="#MAMLModel.zero_grad">zero_grad</a>
                        </li>
                        <li>
                                <a class="function" href="#MAMLModel.parameters">parameters</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MAMLHandler">MAMLHandler</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MAMLHandler.__init__">MAMLHandler</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.model">model</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.device">device</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.trainLoader">trainLoader</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.validationLoader">validationLoader</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.stepsInInnerLoopTrain">stepsInInnerLoopTrain</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.stepsInInnerLoopValid">stepsInInnerLoopValid</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.adaptLearningRate">adaptLearningRate</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.epochs">epochs</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.meta_optim">meta_optim</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.modelName">modelName</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.modelSaveDir">modelSaveDir</a>
                        </li>
                        <li>
                                <a class="variable" href="#MAMLHandler.live">live</a>
                        </li>
                        <li>
                                <a class="function" href="#MAMLHandler.train">train</a>
                        </li>
                        <li>
                                <a class="function" href="#MAMLHandler.test">test</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../metalearning.html">metalearning</a><wbr>.maml    </h1>

                
                        <input id="mod-maml-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-maml-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">no_grad</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">autograd</span><span class="p">,</span> <span class="n">eq</span><span class="p">,</span> <span class="n">sigmoid</span><span class="p">,</span> <span class="n">unsqueeze</span><span class="p">,</span> <span class="n">save</span><span class="p">,</span> <span class="n">load</span><span class="p">,</span> <span class="n">optim</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">import</span> <span class="n">functional</span> <span class="k">as</span> <span class="n">F</span><span class="p">,</span> <span class="n">Module</span><span class="p">,</span> <span class="n">ParameterList</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">from</span> <span class="nn">metalearning</span> <span class="kn">import</span> <span class="n">constants</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">dvclive</span> <span class="kn">import</span> <span class="n">Live</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="k">class</span> <span class="nc">MAMLModel</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Class of `torch.nn.Module` objects that are to be trained using MAML.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">    The architecture needs to be defined as list of tuples. And other</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">    attributes need to be defines as shown in the following example:</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">    </span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">    ```python</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    class ForMiniimagenet(MAMLModel):</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">        def __init__(self):</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">            super().__init__()</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">            self.config = [</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">                (&#39;conv2d&#39;, [32, 3, 3, 3, 1, 0]),</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">                (&#39;relu&#39;, [True]),</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">                (&#39;bn&#39;, [32]),</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">                (&#39;max_pool2d&#39;, [2, 2, 0]),</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">                (&#39;conv2d&#39;, [32, 32, 3, 3, 1, 0]),</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">                (&#39;relu&#39;, [True]),</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">                (&#39;bn&#39;, [32]),</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">                (&#39;max_pool2d&#39;, [2, 2, 0]),</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">                (&#39;conv2d&#39;, [32, 32, 3, 3, 1, 0]),</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">                (&#39;relu&#39;, [True]),</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">                (&#39;bn&#39;, [32]),</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">                (&#39;max_pool2d&#39;, [2, 2, 0]),</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">                (&#39;conv2d&#39;, [32, 32, 3, 3, 1, 0]),</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">                (&#39;relu&#39;, [True]),</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">                (&#39;bn&#39;, [32]),</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">                (&#39;max_pool2d&#39;, [2, 1, 0]),</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">                (&#39;flatten&#39;, []),</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">                (&#39;linear&#39;, [5, 32 * 5 * 5])</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">            ]</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">            self.vars, self.vars_bn = modelParametersInitializer(architecture=self.config)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">    ```</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="c1"># this dict contains all tensors needed to be optimized</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParameterList</span><span class="p">()</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;parameters of model&quot;&quot;&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="c1"># running_mean and running_var</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParameterList</span><span class="p">()</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;running_mean and running_var for batch norm&quot;&quot;&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="nb">vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span> <span class="n">bn_training</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to run forward pass</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">        Parameters</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">        ----------</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">        x : Tensor</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">            input</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">        vars : Union[ParameterList, list]</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">            parameters (or fast parameters)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        bn_training : bool, optional</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">            To enable of disable batch norm training, by default True</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">        Returns</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">        -------</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">        Tensor</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">            Output</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">        Raises</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">        ------</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">        NotImplementedError</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">            Raised when architecture component is not defined</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        &quot;&quot;&quot;</span>              
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="k">if</span> <span class="nb">vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>            <span class="nb">vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="n">bn_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;conv2d&#39;</span><span class="p">:</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>                <span class="c1"># remember to keep synchrozied of forward_encoder and forward_decoder!</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">groups</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>                <span class="c1"># print(name, param, &#39;\tout:&#39;, x.shape)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;convt2d&#39;</span><span class="p">:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>                <span class="c1"># remember to keep synchrozied of forward_encoder and forward_decoder!</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">conv_transpose2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">groups</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>                <span class="c1"># print(name, param, &#39;\tout:&#39;, x.shape)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                <span class="c1"># print(&#39;forward:&#39;, idx, x.norm().item())</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;bn&#39;</span><span class="p">:</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>                <span class="n">running_mean</span><span class="p">,</span> <span class="n">running_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">[</span><span class="n">bn_idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">[</span><span class="n">bn_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">batch_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">running_mean</span><span class="p">,</span> <span class="n">running_var</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="n">bn_training</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                <span class="n">bn_idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ln&#39;</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">layer_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;flatten&#39;</span><span class="p">:</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>                <span class="c1"># print(x.shape)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;reshape&#39;</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                <span class="c1"># [b, 8] =&gt; [b, 2, 2, 2]</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">*</span><span class="n">param</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;relu&#39;</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;leakyrelu&#39;</span><span class="p">:</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">leaky_relu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">negative_slope</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;tanh&#39;</span><span class="p">:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;upsample&#39;</span><span class="p">:</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">upsample_nearest</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;max_pool2d&#39;</span><span class="p">:</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">max_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;avg_pool2d&#39;</span><span class="p">:</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">avg_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dropout&#39;</span><span class="p">:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bn_training</span><span class="p">)</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;unsqueeze&#39;</span><span class="p">:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">unsqueeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;elu&#39;</span><span class="p">:</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">elu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="c1"># make sure variable is used properly</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="k">assert</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="k">assert</span> <span class="n">bn_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>    <span class="k">def</span> <span class="nf">extra_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for custom representation</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">        Returns</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">        -------</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        str</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">            string representation</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">        Raises</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">        ------</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        NotImplementedError</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">            Raised when architecture component is not defined</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;conv2d&#39;</span><span class="p">:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;conv2d:(ch_in:</span><span class="si">%d</span><span class="s1">, ch_out:</span><span class="si">%d</span><span class="s1">, k:</span><span class="si">%d</span><span class="s1">x</span><span class="si">%d</span><span class="s1">, stride:</span><span class="si">%d</span><span class="s1">, padding:</span><span class="si">%s</span><span class="s1">, groups:</span><span class="si">%d</span><span class="s1">)&#39;</span>\
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>                      <span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;convt2d&#39;</span><span class="p">:</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;convTranspose2d:(ch_in:</span><span class="si">%d</span><span class="s1">, ch_out:</span><span class="si">%d</span><span class="s1">, k:</span><span class="si">%d</span><span class="s1">x</span><span class="si">%d</span><span class="s1">, stride:</span><span class="si">%d</span><span class="s1">, padding:</span><span class="si">%s</span><span class="s1">, groups:</span><span class="si">%d</span><span class="s1">)&#39;</span>\
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>                      <span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;linear:(in:</span><span class="si">%d</span><span class="s1">, out:</span><span class="si">%d</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;leakyrelu&#39;</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;leakyrelu:(slope:</span><span class="si">%f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;avg_pool2d&#39;</span><span class="p">:</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;avg_pool2d:(k:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, stride:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, padding:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;max_pool2d&#39;</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;max_pool2d:(k:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, stride:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, padding:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;flatten&#39;</span><span class="p">,</span> <span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;upsample&#39;</span><span class="p">,</span> <span class="s1">&#39;reshape&#39;</span><span class="p">,</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">,</span> <span class="s1">&#39;use_logits&#39;</span><span class="p">,</span> <span class="s1">&#39;bn&#39;</span><span class="p">,</span> <span class="s1">&#39;ln&#39;</span><span class="p">,</span> <span class="s1">&#39;dropout&#39;</span><span class="p">,</span> <span class="s1">&#39;unsqueeze&#39;</span><span class="p">,</span> <span class="s1">&#39;elu&#39;</span><span class="p">]:</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="k">return</span> <span class="n">info</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>    <span class="k">def</span> <span class="nf">zero_grad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Custom method to make gradients of custom parameters zero</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        Parameters</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        ----------</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">        vars : Union[ParameterList, list], optional</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">            Parameters (or fast parameters), by default None</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a><span class="sd">        &quot;&quot;&quot;</span>              
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="k">with</span> <span class="n">no_grad</span><span class="p">():</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>            <span class="k">if</span> <span class="nb">vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>                        <span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>                        <span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;override this function since initial parameters will return with a generator.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">        Returns</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        -------</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">        Union[ParameterList, list]</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">            The parameters of the model</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="k">class</span> <span class="nc">MAMLHandler</span><span class="p">:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper class to train a model using Meta Agnostic Meta Learning</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">    &quot;&quot;&quot;</span>    
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">trainDataLoader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="n">validationDataLoader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">updateStepsInInnerLoopTrain</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>            <span class="n">updateStepsInInnerLoopValid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">adaptLearningRate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>            <span class="n">optimizer</span><span class="p">,</span> <span class="n">live</span><span class="p">:</span> <span class="n">Live</span><span class="p">,</span> <span class="n">modelSaveDir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">modelName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    <span class="p">):</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        Creating an object of MAMLHandler class.</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">        Parameters</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">        ----------</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">        model : Module</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">            Model to be trained</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">        device : int</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">            device id</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">        trainDataLoader : DataLoader</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">            train data loader</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">        validationDataLoader : DataLoader</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">            validation data loader</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">        updateStepsInInnerLoopTrain : int</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">            number of gradient update steps while training</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        updateStepsInInnerLoopTest : int</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">            number of gradient update steps while validation</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        adaptLearningRate : float</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">            learning while adapting (inner loop)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">        epochs : int</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a><span class="sd">            number of epochs</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a><span class="sd">        optimizer : torch.optim.Optimizer</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a><span class="sd">            Optimizer to be used</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">        live : dvclive.Live</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">            A DVC live object for logging</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">        modelSaveDir : str, optional</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">            dir path to stoe model, by default None</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">        modelName : str, optional</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a><span class="sd">            Name of model when saved</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a><span class="sd">        &quot;&quot;&quot;</span>             
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span> <span class="n">Module</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided model during object creation&quot;&quot;&quot;</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided GPU device&quot;&quot;&quot;</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trainLoader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">=</span> <span class="n">trainDataLoader</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided train dataloader&quot;&quot;&quot;</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validationLoader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">=</span> <span class="n">validationDataLoader</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided validation dataloader&quot;&quot;&quot;</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopTrain</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">updateStepsInInnerLoopTrain</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of update steps provided for inner loop while training&quot;&quot;&quot;</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">updateStepsInInnerLoopValid</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of update steps provided for inner loop while validation&quot;&quot;&quot;</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adaptLearningRate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">adaptLearningRate</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided learning rate for inner loop&quot;&quot;&quot;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">epochs</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided number of epochs&quot;&quot;&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_optim</span><span class="p">:</span> <span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided torch optimizer&quot;&quot;&quot;</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">modelName</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided name of the model file&quot;&quot;&quot;</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">modelSaveDir</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided path to directory to sabe the model&quot;&quot;&quot;</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="p">:</span> <span class="n">Live</span> <span class="o">=</span> <span class="n">live</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided DVC live object&quot;&quot;&quot;</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>    
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>    <span class="k">def</span> <span class="nf">__performAction</span><span class="p">(</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">actionType</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">X_support</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">y_support</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">X_query</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="n">y_query</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">adapt_steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="k">assert</span> <span class="n">actionType</span> <span class="ow">in</span> <span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">FINETUNE</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">]</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="n">task_num</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="n">supportsz</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="n">querysz</span> <span class="o">=</span> <span class="n">X_query</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>\
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="n">y_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">X_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">y_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="n">batch_norm_query</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="k">if</span> <span class="n">actionType</span> <span class="ow">in</span> <span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">FINETUNE</span><span class="p">]:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>            <span class="n">batch_norm_query</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>        <span class="c1">#losses_q[i] is the loss on step i</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>        <span class="n">losses_q</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">adapt_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> 
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>        <span class="n">corrects</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">adapt_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>        <span class="k">if</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>            <span class="n">corrects_support</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">adapt_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>    
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">task_num</span><span class="p">):</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>            <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_support</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bn_training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>            <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y_support</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>            <span class="n">grad</span> <span class="o">=</span> <span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>            <span class="n">fast_weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>                <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptLearningRate</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>            <span class="p">))</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>            <span class="c1"># this is the loss and accuracy before first update</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="k">with</span> <span class="n">no_grad</span><span class="p">():</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>                <span class="c1"># [setsz, nway]</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>                <span class="k">if</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>                    <span class="n">pred_support</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>                    <span class="n">corrects_support</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects_support</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>                <span class="n">logits_q</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_query</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">bn_training</span><span class="o">=</span><span class="n">batch_norm_query</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>                <span class="n">loss_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>                <span class="n">losses_q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss_q</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>                <span class="n">pred_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>                <span class="n">correct</span> <span class="o">=</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>                <span class="n">corrects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">correct</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>            <span class="c1"># this is the loss and accuracy after the first update</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>            <span class="k">with</span> <span class="n">no_grad</span><span class="p">():</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>                <span class="c1"># [setsz, nway]</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>                <span class="k">if</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>                    <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_support</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">vars</span><span class="o">=</span><span class="n">fast_weights</span><span class="p">,</span> <span class="n">bn_training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>                    <span class="n">pred_support</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>                    <span class="n">corrects_support</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects_support</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>                <span class="n">logits_q</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_query</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fast_weights</span><span class="p">,</span> <span class="n">bn_training</span><span class="o">=</span><span class="n">batch_norm_query</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>                <span class="n">loss_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>                <span class="n">losses_q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss_q</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>                <span class="c1"># [setsz]</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>                <span class="n">pred_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>                <span class="n">correct</span> <span class="o">=</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>                <span class="n">corrects</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">correct</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">adapt_steps</span><span class="p">):</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>                <span class="c1"># 1. run the i-th task and compute loss for k=1~K-1</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>                <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_support</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fast_weights</span><span class="p">,</span> <span class="n">bn_training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y_support</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>                <span class="c1"># 2. compute grad on theta_pi</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                <span class="n">grad</span> <span class="o">=</span> <span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">fast_weights</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>                <span class="c1"># 3. theta_pi = theta_pi - train_lr * grad</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>                <span class="n">fast_weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>                    <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptLearningRate</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="n">fast_weights</span><span class="p">)</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>                <span class="p">))</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                <span class="n">logits_q</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_query</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fast_weights</span><span class="p">,</span> <span class="n">bn_training</span><span class="o">=</span><span class="n">batch_norm_query</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>                <span class="c1"># loss_q will be overwritten and just keep the loss_q on last update step.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>                <span class="n">loss_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>                <span class="n">losses_q</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss_q</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>                <span class="k">with</span> <span class="n">no_grad</span><span class="p">():</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>                    <span class="k">if</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>                        <span class="n">pred_support</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>                        <span class="n">corrects_support</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects_support</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>                    <span class="n">pred_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>                    <span class="n">correct</span> <span class="o">=</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>  <span class="c1"># convert to numpy</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>                    <span class="n">corrects</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">correct</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="c1"># end of all tasks</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>        <span class="c1"># sum over all losses on query set across all tasks</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>        <span class="n">loss_q</span> <span class="o">=</span> <span class="n">losses_q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">task_num</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="c1"># optimize theta parameters</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="n">actionType</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span><span class="p">:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_optim</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="n">loss_q</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_optim</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="n">accs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">corrects</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">querysz</span> <span class="o">*</span> <span class="n">task_num</span><span class="p">)</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="k">if</span> <span class="n">actionType</span> <span class="o">==</span> <span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>            <span class="k">del</span> <span class="n">model</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>            <span class="k">if</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>                <span class="n">accs_support</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">corrects_support</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">supportsz</span> <span class="o">*</span> <span class="n">task_num</span><span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>                <span class="k">return</span> <span class="n">accs</span><span class="p">,</span> <span class="n">accs_support</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>            <span class="k">return</span> <span class="n">accs</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="k">if</span> <span class="n">actionType</span> <span class="o">==</span> <span class="n">constants</span><span class="o">.</span><span class="n">FINETUNE</span><span class="p">:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>            <span class="k">return</span>  <span class="n">model</span><span class="p">,</span><span class="n">accs</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="k">return</span> <span class="n">accs</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>    
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to start the MAML training</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="n">maxValidationAccSoFar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NINF</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Epochs&#39;</span><span class="p">):</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>            <span class="n">acc_all_train</span> <span class="o">=</span> <span class="p">[]</span> 
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>            <span class="k">for</span> <span class="n">metaStep</span><span class="p">,</span> <span class="p">(</span><span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainLoader</span><span class="p">):</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>                <span class="n">X_support</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>                <span class="n">y_support</span> <span class="o">=</span> <span class="n">y_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>                <span class="n">X_query</span> <span class="o">=</span> <span class="n">X_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>                <span class="n">y_query</span> <span class="o">=</span> <span class="n">y_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>                <span class="c1">## performe a meta update</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>                <span class="n">trainAcc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>                    <span class="n">constants</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">,</span> <span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopTrain</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>                <span class="p">)</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>                <span class="n">acc_all_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trainAcc</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>                <span class="k">if</span> <span class="n">metaStep</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;step:&#39;</span><span class="p">,</span> <span class="n">metaStep</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">training acc:&#39;</span><span class="p">,</span> <span class="n">trainAcc</span><span class="p">)</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>                <span class="k">if</span> <span class="n">metaStep</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># evaluation or validation</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>                    <span class="n">accs_all_validation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>                    <span class="k">for</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validationLoader</span><span class="p">:</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>                        <span class="n">accs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span><span class="p">)</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>                        <span class="n">accs_all_validation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accs</span><span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>                    <span class="n">accs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">accs_all_validation</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Validation acc:&#39;</span><span class="p">,</span> <span class="n">accs</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>            <span class="n">accs_all_validation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="k">for</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validationLoader</span><span class="p">:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>                <span class="n">accs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>                <span class="n">accs_all_validation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accs</span><span class="p">)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="n">acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_all_train</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;training_acc_vs_epoch&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="n">acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">accs_all_validation</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;validation_acc_vs_epoch&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>            <span class="k">if</span> <span class="n">acc</span> <span class="o">&gt;</span> <span class="n">maxValidationAccSoFar</span><span class="p">:</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>                <span class="n">maxValidationAccSoFar</span> <span class="o">=</span> <span class="n">acc</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>                <span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span> <span class="o">+</span> <span class="s2">&quot;.pt&quot;</span><span class="p">))</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current Validation Accuracy: </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max Validation Accuracy so far: </span><span class="si">{</span><span class="n">maxValidationAccSoFar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">next_step</span><span class="p">()</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span> <span class="o">+</span> <span class="s2">&quot;.pt&quot;</span><span class="p">),</span> <span class="n">map_location</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;best_validation_acc&quot;</span><span class="p">,</span> <span class="n">maxValidationAccSoFar</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>    
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_data</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">adapt_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check performance on test data</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">        Parameters</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">        ----------</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">        test_data : DataLoader</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">            The test data</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">        adapt_steps : int, optional</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">            Number of steps for adaptation. If None then same as that in validation, by default None</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">        Returns</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        -------</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">        tuple</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">            Tuple containing test accuracies and training accuracies during finetuning at  each</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">            iteration. Both the elements of the tuple is a list. Also the accuracies are avreaged</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">            over all the provided subjects.</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span> <span class="o">+</span> <span class="s2">&quot;.pt&quot;</span><span class="p">),</span> <span class="n">map_location</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="n">adapt_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span> <span class="k">if</span> <span class="n">adapt_steps</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">adapt_steps</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="n">acc_all_finetune</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>        <span class="n">acc_all_test</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>        <span class="k">for</span> <span class="n">metaStep</span><span class="p">,</span> <span class="p">(</span><span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_data</span><span class="p">):</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>                <span class="n">X_support</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>                <span class="n">y_support</span> <span class="o">=</span> <span class="n">y_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>                <span class="n">X_query</span> <span class="o">=</span> <span class="n">X_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>                <span class="n">y_query</span> <span class="o">=</span> <span class="n">y_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>                    <span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">,</span> <span class="n">adapt_steps</span><span class="p">,</span> <span class="kc">True</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>                <span class="p">)</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>                <span class="n">acc_all_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>                <span class="n">acc_all_finetune</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_all_test</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_all_finetune</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="MAMLModel">
                            <input id="MAMLModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MAMLModel</span><wbr>(<span class="base">torch.nn.modules.module.Module</span>):

                <label class="view-source-button" for="MAMLModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MAMLModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MAMLModel-13"><a href="#MAMLModel-13"><span class="linenos"> 13</span></a><span class="k">class</span> <span class="nc">MAMLModel</span><span class="p">(</span><span class="n">Module</span><span class="p">):</span>
</span><span id="MAMLModel-14"><a href="#MAMLModel-14"><span class="linenos"> 14</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Class of `torch.nn.Module` objects that are to be trained using MAML.</span>
</span><span id="MAMLModel-15"><a href="#MAMLModel-15"><span class="linenos"> 15</span></a><span class="sd">    The architecture needs to be defined as list of tuples. And other</span>
</span><span id="MAMLModel-16"><a href="#MAMLModel-16"><span class="linenos"> 16</span></a><span class="sd">    attributes need to be defines as shown in the following example:</span>
</span><span id="MAMLModel-17"><a href="#MAMLModel-17"><span class="linenos"> 17</span></a><span class="sd">    </span>
</span><span id="MAMLModel-18"><a href="#MAMLModel-18"><span class="linenos"> 18</span></a><span class="sd">    ```python</span>
</span><span id="MAMLModel-19"><a href="#MAMLModel-19"><span class="linenos"> 19</span></a><span class="sd">    class ForMiniimagenet(MAMLModel):</span>
</span><span id="MAMLModel-20"><a href="#MAMLModel-20"><span class="linenos"> 20</span></a><span class="sd">        def __init__(self):</span>
</span><span id="MAMLModel-21"><a href="#MAMLModel-21"><span class="linenos"> 21</span></a><span class="sd">            super().__init__()</span>
</span><span id="MAMLModel-22"><a href="#MAMLModel-22"><span class="linenos"> 22</span></a><span class="sd">            self.config = [</span>
</span><span id="MAMLModel-23"><a href="#MAMLModel-23"><span class="linenos"> 23</span></a><span class="sd">                (&#39;conv2d&#39;, [32, 3, 3, 3, 1, 0]),</span>
</span><span id="MAMLModel-24"><a href="#MAMLModel-24"><span class="linenos"> 24</span></a><span class="sd">                (&#39;relu&#39;, [True]),</span>
</span><span id="MAMLModel-25"><a href="#MAMLModel-25"><span class="linenos"> 25</span></a><span class="sd">                (&#39;bn&#39;, [32]),</span>
</span><span id="MAMLModel-26"><a href="#MAMLModel-26"><span class="linenos"> 26</span></a><span class="sd">                (&#39;max_pool2d&#39;, [2, 2, 0]),</span>
</span><span id="MAMLModel-27"><a href="#MAMLModel-27"><span class="linenos"> 27</span></a><span class="sd">                (&#39;conv2d&#39;, [32, 32, 3, 3, 1, 0]),</span>
</span><span id="MAMLModel-28"><a href="#MAMLModel-28"><span class="linenos"> 28</span></a><span class="sd">                (&#39;relu&#39;, [True]),</span>
</span><span id="MAMLModel-29"><a href="#MAMLModel-29"><span class="linenos"> 29</span></a><span class="sd">                (&#39;bn&#39;, [32]),</span>
</span><span id="MAMLModel-30"><a href="#MAMLModel-30"><span class="linenos"> 30</span></a><span class="sd">                (&#39;max_pool2d&#39;, [2, 2, 0]),</span>
</span><span id="MAMLModel-31"><a href="#MAMLModel-31"><span class="linenos"> 31</span></a><span class="sd">                (&#39;conv2d&#39;, [32, 32, 3, 3, 1, 0]),</span>
</span><span id="MAMLModel-32"><a href="#MAMLModel-32"><span class="linenos"> 32</span></a><span class="sd">                (&#39;relu&#39;, [True]),</span>
</span><span id="MAMLModel-33"><a href="#MAMLModel-33"><span class="linenos"> 33</span></a><span class="sd">                (&#39;bn&#39;, [32]),</span>
</span><span id="MAMLModel-34"><a href="#MAMLModel-34"><span class="linenos"> 34</span></a><span class="sd">                (&#39;max_pool2d&#39;, [2, 2, 0]),</span>
</span><span id="MAMLModel-35"><a href="#MAMLModel-35"><span class="linenos"> 35</span></a><span class="sd">                (&#39;conv2d&#39;, [32, 32, 3, 3, 1, 0]),</span>
</span><span id="MAMLModel-36"><a href="#MAMLModel-36"><span class="linenos"> 36</span></a><span class="sd">                (&#39;relu&#39;, [True]),</span>
</span><span id="MAMLModel-37"><a href="#MAMLModel-37"><span class="linenos"> 37</span></a><span class="sd">                (&#39;bn&#39;, [32]),</span>
</span><span id="MAMLModel-38"><a href="#MAMLModel-38"><span class="linenos"> 38</span></a><span class="sd">                (&#39;max_pool2d&#39;, [2, 1, 0]),</span>
</span><span id="MAMLModel-39"><a href="#MAMLModel-39"><span class="linenos"> 39</span></a><span class="sd">                (&#39;flatten&#39;, []),</span>
</span><span id="MAMLModel-40"><a href="#MAMLModel-40"><span class="linenos"> 40</span></a><span class="sd">                (&#39;linear&#39;, [5, 32 * 5 * 5])</span>
</span><span id="MAMLModel-41"><a href="#MAMLModel-41"><span class="linenos"> 41</span></a><span class="sd">            ]</span>
</span><span id="MAMLModel-42"><a href="#MAMLModel-42"><span class="linenos"> 42</span></a><span class="sd">            self.vars, self.vars_bn = modelParametersInitializer(architecture=self.config)</span>
</span><span id="MAMLModel-43"><a href="#MAMLModel-43"><span class="linenos"> 43</span></a><span class="sd">    ```</span>
</span><span id="MAMLModel-44"><a href="#MAMLModel-44"><span class="linenos"> 44</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MAMLModel-45"><a href="#MAMLModel-45"><span class="linenos"> 45</span></a>
</span><span id="MAMLModel-46"><a href="#MAMLModel-46"><span class="linenos"> 46</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MAMLModel-47"><a href="#MAMLModel-47"><span class="linenos"> 47</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="MAMLModel-48"><a href="#MAMLModel-48"><span class="linenos"> 48</span></a>        <span class="c1"># this dict contains all tensors needed to be optimized</span>
</span><span id="MAMLModel-49"><a href="#MAMLModel-49"><span class="linenos"> 49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParameterList</span><span class="p">()</span>
</span><span id="MAMLModel-50"><a href="#MAMLModel-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;parameters of model&quot;&quot;&quot;</span>
</span><span id="MAMLModel-51"><a href="#MAMLModel-51"><span class="linenos"> 51</span></a>        <span class="c1"># running_mean and running_var</span>
</span><span id="MAMLModel-52"><a href="#MAMLModel-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParameterList</span><span class="p">()</span>
</span><span id="MAMLModel-53"><a href="#MAMLModel-53"><span class="linenos"> 53</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;running_mean and running_var for batch norm&quot;&quot;&quot;</span>
</span><span id="MAMLModel-54"><a href="#MAMLModel-54"><span class="linenos"> 54</span></a>    
</span><span id="MAMLModel-55"><a href="#MAMLModel-55"><span class="linenos"> 55</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="nb">vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span> <span class="n">bn_training</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="MAMLModel-56"><a href="#MAMLModel-56"><span class="linenos"> 56</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to run forward pass</span>
</span><span id="MAMLModel-57"><a href="#MAMLModel-57"><span class="linenos"> 57</span></a>
</span><span id="MAMLModel-58"><a href="#MAMLModel-58"><span class="linenos"> 58</span></a><span class="sd">        Parameters</span>
</span><span id="MAMLModel-59"><a href="#MAMLModel-59"><span class="linenos"> 59</span></a><span class="sd">        ----------</span>
</span><span id="MAMLModel-60"><a href="#MAMLModel-60"><span class="linenos"> 60</span></a><span class="sd">        x : Tensor</span>
</span><span id="MAMLModel-61"><a href="#MAMLModel-61"><span class="linenos"> 61</span></a><span class="sd">            input</span>
</span><span id="MAMLModel-62"><a href="#MAMLModel-62"><span class="linenos"> 62</span></a><span class="sd">        vars : Union[ParameterList, list]</span>
</span><span id="MAMLModel-63"><a href="#MAMLModel-63"><span class="linenos"> 63</span></a><span class="sd">            parameters (or fast parameters)</span>
</span><span id="MAMLModel-64"><a href="#MAMLModel-64"><span class="linenos"> 64</span></a><span class="sd">        bn_training : bool, optional</span>
</span><span id="MAMLModel-65"><a href="#MAMLModel-65"><span class="linenos"> 65</span></a><span class="sd">            To enable of disable batch norm training, by default True</span>
</span><span id="MAMLModel-66"><a href="#MAMLModel-66"><span class="linenos"> 66</span></a>
</span><span id="MAMLModel-67"><a href="#MAMLModel-67"><span class="linenos"> 67</span></a><span class="sd">        Returns</span>
</span><span id="MAMLModel-68"><a href="#MAMLModel-68"><span class="linenos"> 68</span></a><span class="sd">        -------</span>
</span><span id="MAMLModel-69"><a href="#MAMLModel-69"><span class="linenos"> 69</span></a><span class="sd">        Tensor</span>
</span><span id="MAMLModel-70"><a href="#MAMLModel-70"><span class="linenos"> 70</span></a><span class="sd">            Output</span>
</span><span id="MAMLModel-71"><a href="#MAMLModel-71"><span class="linenos"> 71</span></a>
</span><span id="MAMLModel-72"><a href="#MAMLModel-72"><span class="linenos"> 72</span></a><span class="sd">        Raises</span>
</span><span id="MAMLModel-73"><a href="#MAMLModel-73"><span class="linenos"> 73</span></a><span class="sd">        ------</span>
</span><span id="MAMLModel-74"><a href="#MAMLModel-74"><span class="linenos"> 74</span></a><span class="sd">        NotImplementedError</span>
</span><span id="MAMLModel-75"><a href="#MAMLModel-75"><span class="linenos"> 75</span></a><span class="sd">            Raised when architecture component is not defined</span>
</span><span id="MAMLModel-76"><a href="#MAMLModel-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>              
</span><span id="MAMLModel-77"><a href="#MAMLModel-77"><span class="linenos"> 77</span></a>        <span class="k">if</span> <span class="nb">vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MAMLModel-78"><a href="#MAMLModel-78"><span class="linenos"> 78</span></a>            <span class="nb">vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
</span><span id="MAMLModel-79"><a href="#MAMLModel-79"><span class="linenos"> 79</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MAMLModel-80"><a href="#MAMLModel-80"><span class="linenos"> 80</span></a>        <span class="n">bn_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MAMLModel-81"><a href="#MAMLModel-81"><span class="linenos"> 81</span></a>
</span><span id="MAMLModel-82"><a href="#MAMLModel-82"><span class="linenos"> 82</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
</span><span id="MAMLModel-83"><a href="#MAMLModel-83"><span class="linenos"> 83</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;conv2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-84"><a href="#MAMLModel-84"><span class="linenos"> 84</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel-85"><a href="#MAMLModel-85"><span class="linenos"> 85</span></a>                <span class="c1"># remember to keep synchrozied of forward_encoder and forward_decoder!</span>
</span><span id="MAMLModel-86"><a href="#MAMLModel-86"><span class="linenos"> 86</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">groups</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="MAMLModel-87"><a href="#MAMLModel-87"><span class="linenos"> 87</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel-88"><a href="#MAMLModel-88"><span class="linenos"> 88</span></a>                <span class="c1"># print(name, param, &#39;\tout:&#39;, x.shape)</span>
</span><span id="MAMLModel-89"><a href="#MAMLModel-89"><span class="linenos"> 89</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;convt2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-90"><a href="#MAMLModel-90"><span class="linenos"> 90</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel-91"><a href="#MAMLModel-91"><span class="linenos"> 91</span></a>                <span class="c1"># remember to keep synchrozied of forward_encoder and forward_decoder!</span>
</span><span id="MAMLModel-92"><a href="#MAMLModel-92"><span class="linenos"> 92</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">conv_transpose2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">groups</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="MAMLModel-93"><a href="#MAMLModel-93"><span class="linenos"> 93</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel-94"><a href="#MAMLModel-94"><span class="linenos"> 94</span></a>                <span class="c1"># print(name, param, &#39;\tout:&#39;, x.shape)</span>
</span><span id="MAMLModel-95"><a href="#MAMLModel-95"><span class="linenos"> 95</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-96"><a href="#MAMLModel-96"><span class="linenos"> 96</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel-97"><a href="#MAMLModel-97"><span class="linenos"> 97</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="MAMLModel-98"><a href="#MAMLModel-98"><span class="linenos"> 98</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel-99"><a href="#MAMLModel-99"><span class="linenos"> 99</span></a>                <span class="c1"># print(&#39;forward:&#39;, idx, x.norm().item())</span>
</span><span id="MAMLModel-100"><a href="#MAMLModel-100"><span class="linenos">100</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;bn&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-101"><a href="#MAMLModel-101"><span class="linenos">101</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel-102"><a href="#MAMLModel-102"><span class="linenos">102</span></a>                <span class="n">running_mean</span><span class="p">,</span> <span class="n">running_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">[</span><span class="n">bn_idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">[</span><span class="n">bn_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel-103"><a href="#MAMLModel-103"><span class="linenos">103</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">batch_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">running_mean</span><span class="p">,</span> <span class="n">running_var</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="n">bn_training</span><span class="p">)</span>
</span><span id="MAMLModel-104"><a href="#MAMLModel-104"><span class="linenos">104</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel-105"><a href="#MAMLModel-105"><span class="linenos">105</span></a>                <span class="n">bn_idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel-106"><a href="#MAMLModel-106"><span class="linenos">106</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ln&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-107"><a href="#MAMLModel-107"><span class="linenos">107</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel-108"><a href="#MAMLModel-108"><span class="linenos">108</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">layer_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="MAMLModel-109"><a href="#MAMLModel-109"><span class="linenos">109</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel-110"><a href="#MAMLModel-110"><span class="linenos">110</span></a>
</span><span id="MAMLModel-111"><a href="#MAMLModel-111"><span class="linenos">111</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;flatten&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-112"><a href="#MAMLModel-112"><span class="linenos">112</span></a>                <span class="c1"># print(x.shape)</span>
</span><span id="MAMLModel-113"><a href="#MAMLModel-113"><span class="linenos">113</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MAMLModel-114"><a href="#MAMLModel-114"><span class="linenos">114</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;reshape&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-115"><a href="#MAMLModel-115"><span class="linenos">115</span></a>                <span class="c1"># [b, 8] =&gt; [b, 2, 2, 2]</span>
</span><span id="MAMLModel-116"><a href="#MAMLModel-116"><span class="linenos">116</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">*</span><span class="n">param</span><span class="p">)</span>
</span><span id="MAMLModel-117"><a href="#MAMLModel-117"><span class="linenos">117</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;relu&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-118"><a href="#MAMLModel-118"><span class="linenos">118</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLModel-119"><a href="#MAMLModel-119"><span class="linenos">119</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;leakyrelu&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-120"><a href="#MAMLModel-120"><span class="linenos">120</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">leaky_relu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">negative_slope</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="MAMLModel-121"><a href="#MAMLModel-121"><span class="linenos">121</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;tanh&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-122"><a href="#MAMLModel-122"><span class="linenos">122</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="MAMLModel-123"><a href="#MAMLModel-123"><span class="linenos">123</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-124"><a href="#MAMLModel-124"><span class="linenos">124</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="MAMLModel-125"><a href="#MAMLModel-125"><span class="linenos">125</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;upsample&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-126"><a href="#MAMLModel-126"><span class="linenos">126</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">upsample_nearest</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLModel-127"><a href="#MAMLModel-127"><span class="linenos">127</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;max_pool2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-128"><a href="#MAMLModel-128"><span class="linenos">128</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">max_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MAMLModel-129"><a href="#MAMLModel-129"><span class="linenos">129</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;avg_pool2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-130"><a href="#MAMLModel-130"><span class="linenos">130</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">avg_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MAMLModel-131"><a href="#MAMLModel-131"><span class="linenos">131</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dropout&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-132"><a href="#MAMLModel-132"><span class="linenos">132</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bn_training</span><span class="p">)</span>
</span><span id="MAMLModel-133"><a href="#MAMLModel-133"><span class="linenos">133</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;unsqueeze&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-134"><a href="#MAMLModel-134"><span class="linenos">134</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">unsqueeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLModel-135"><a href="#MAMLModel-135"><span class="linenos">135</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;elu&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-136"><a href="#MAMLModel-136"><span class="linenos">136</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">elu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="MAMLModel-137"><a href="#MAMLModel-137"><span class="linenos">137</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MAMLModel-138"><a href="#MAMLModel-138"><span class="linenos">138</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="MAMLModel-139"><a href="#MAMLModel-139"><span class="linenos">139</span></a>
</span><span id="MAMLModel-140"><a href="#MAMLModel-140"><span class="linenos">140</span></a>        <span class="c1"># make sure variable is used properly</span>
</span><span id="MAMLModel-141"><a href="#MAMLModel-141"><span class="linenos">141</span></a>        <span class="k">assert</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span>
</span><span id="MAMLModel-142"><a href="#MAMLModel-142"><span class="linenos">142</span></a>        <span class="k">assert</span> <span class="n">bn_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">)</span>
</span><span id="MAMLModel-143"><a href="#MAMLModel-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="n">x</span>
</span><span id="MAMLModel-144"><a href="#MAMLModel-144"><span class="linenos">144</span></a>    
</span><span id="MAMLModel-145"><a href="#MAMLModel-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">extra_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MAMLModel-146"><a href="#MAMLModel-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for custom representation</span>
</span><span id="MAMLModel-147"><a href="#MAMLModel-147"><span class="linenos">147</span></a>
</span><span id="MAMLModel-148"><a href="#MAMLModel-148"><span class="linenos">148</span></a><span class="sd">        Returns</span>
</span><span id="MAMLModel-149"><a href="#MAMLModel-149"><span class="linenos">149</span></a><span class="sd">        -------</span>
</span><span id="MAMLModel-150"><a href="#MAMLModel-150"><span class="linenos">150</span></a><span class="sd">        str</span>
</span><span id="MAMLModel-151"><a href="#MAMLModel-151"><span class="linenos">151</span></a><span class="sd">            string representation</span>
</span><span id="MAMLModel-152"><a href="#MAMLModel-152"><span class="linenos">152</span></a>
</span><span id="MAMLModel-153"><a href="#MAMLModel-153"><span class="linenos">153</span></a><span class="sd">        Raises</span>
</span><span id="MAMLModel-154"><a href="#MAMLModel-154"><span class="linenos">154</span></a><span class="sd">        ------</span>
</span><span id="MAMLModel-155"><a href="#MAMLModel-155"><span class="linenos">155</span></a><span class="sd">        NotImplementedError</span>
</span><span id="MAMLModel-156"><a href="#MAMLModel-156"><span class="linenos">156</span></a><span class="sd">            Raised when architecture component is not defined</span>
</span><span id="MAMLModel-157"><a href="#MAMLModel-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="MAMLModel-158"><a href="#MAMLModel-158"><span class="linenos">158</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="MAMLModel-159"><a href="#MAMLModel-159"><span class="linenos">159</span></a>
</span><span id="MAMLModel-160"><a href="#MAMLModel-160"><span class="linenos">160</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
</span><span id="MAMLModel-161"><a href="#MAMLModel-161"><span class="linenos">161</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;conv2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-162"><a href="#MAMLModel-162"><span class="linenos">162</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;conv2d:(ch_in:</span><span class="si">%d</span><span class="s1">, ch_out:</span><span class="si">%d</span><span class="s1">, k:</span><span class="si">%d</span><span class="s1">x</span><span class="si">%d</span><span class="s1">, stride:</span><span class="si">%d</span><span class="s1">, padding:</span><span class="si">%s</span><span class="s1">, groups:</span><span class="si">%d</span><span class="s1">)&#39;</span>\
</span><span id="MAMLModel-163"><a href="#MAMLModel-163"><span class="linenos">163</span></a>                      <span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="MAMLModel-164"><a href="#MAMLModel-164"><span class="linenos">164</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel-165"><a href="#MAMLModel-165"><span class="linenos">165</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;convt2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-166"><a href="#MAMLModel-166"><span class="linenos">166</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;convTranspose2d:(ch_in:</span><span class="si">%d</span><span class="s1">, ch_out:</span><span class="si">%d</span><span class="s1">, k:</span><span class="si">%d</span><span class="s1">x</span><span class="si">%d</span><span class="s1">, stride:</span><span class="si">%d</span><span class="s1">, padding:</span><span class="si">%s</span><span class="s1">, groups:</span><span class="si">%d</span><span class="s1">)&#39;</span>\
</span><span id="MAMLModel-167"><a href="#MAMLModel-167"><span class="linenos">167</span></a>                      <span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="MAMLModel-168"><a href="#MAMLModel-168"><span class="linenos">168</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel-169"><a href="#MAMLModel-169"><span class="linenos">169</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-170"><a href="#MAMLModel-170"><span class="linenos">170</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;linear:(in:</span><span class="si">%d</span><span class="s1">, out:</span><span class="si">%d</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLModel-171"><a href="#MAMLModel-171"><span class="linenos">171</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel-172"><a href="#MAMLModel-172"><span class="linenos">172</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;leakyrelu&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-173"><a href="#MAMLModel-173"><span class="linenos">173</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;leakyrelu:(slope:</span><span class="si">%f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLModel-174"><a href="#MAMLModel-174"><span class="linenos">174</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel-175"><a href="#MAMLModel-175"><span class="linenos">175</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;avg_pool2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-176"><a href="#MAMLModel-176"><span class="linenos">176</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;avg_pool2d:(k:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, stride:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, padding:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="MAMLModel-177"><a href="#MAMLModel-177"><span class="linenos">177</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel-178"><a href="#MAMLModel-178"><span class="linenos">178</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;max_pool2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel-179"><a href="#MAMLModel-179"><span class="linenos">179</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;max_pool2d:(k:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, stride:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, padding:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="MAMLModel-180"><a href="#MAMLModel-180"><span class="linenos">180</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel-181"><a href="#MAMLModel-181"><span class="linenos">181</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;flatten&#39;</span><span class="p">,</span> <span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;upsample&#39;</span><span class="p">,</span> <span class="s1">&#39;reshape&#39;</span><span class="p">,</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">,</span> <span class="s1">&#39;use_logits&#39;</span><span class="p">,</span> <span class="s1">&#39;bn&#39;</span><span class="p">,</span> <span class="s1">&#39;ln&#39;</span><span class="p">,</span> <span class="s1">&#39;dropout&#39;</span><span class="p">,</span> <span class="s1">&#39;unsqueeze&#39;</span><span class="p">,</span> <span class="s1">&#39;elu&#39;</span><span class="p">]:</span>
</span><span id="MAMLModel-182"><a href="#MAMLModel-182"><span class="linenos">182</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>
</span><span id="MAMLModel-183"><a href="#MAMLModel-183"><span class="linenos">183</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel-184"><a href="#MAMLModel-184"><span class="linenos">184</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MAMLModel-185"><a href="#MAMLModel-185"><span class="linenos">185</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="MAMLModel-186"><a href="#MAMLModel-186"><span class="linenos">186</span></a>
</span><span id="MAMLModel-187"><a href="#MAMLModel-187"><span class="linenos">187</span></a>        <span class="k">return</span> <span class="n">info</span>
</span><span id="MAMLModel-188"><a href="#MAMLModel-188"><span class="linenos">188</span></a>    
</span><span id="MAMLModel-189"><a href="#MAMLModel-189"><span class="linenos">189</span></a>    <span class="k">def</span> <span class="nf">zero_grad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MAMLModel-190"><a href="#MAMLModel-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Custom method to make gradients of custom parameters zero</span>
</span><span id="MAMLModel-191"><a href="#MAMLModel-191"><span class="linenos">191</span></a>
</span><span id="MAMLModel-192"><a href="#MAMLModel-192"><span class="linenos">192</span></a><span class="sd">        Parameters</span>
</span><span id="MAMLModel-193"><a href="#MAMLModel-193"><span class="linenos">193</span></a><span class="sd">        ----------</span>
</span><span id="MAMLModel-194"><a href="#MAMLModel-194"><span class="linenos">194</span></a><span class="sd">        vars : Union[ParameterList, list], optional</span>
</span><span id="MAMLModel-195"><a href="#MAMLModel-195"><span class="linenos">195</span></a><span class="sd">            Parameters (or fast parameters), by default None</span>
</span><span id="MAMLModel-196"><a href="#MAMLModel-196"><span class="linenos">196</span></a><span class="sd">        &quot;&quot;&quot;</span>              
</span><span id="MAMLModel-197"><a href="#MAMLModel-197"><span class="linenos">197</span></a>        <span class="k">with</span> <span class="n">no_grad</span><span class="p">():</span>
</span><span id="MAMLModel-198"><a href="#MAMLModel-198"><span class="linenos">198</span></a>            <span class="k">if</span> <span class="nb">vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MAMLModel-199"><a href="#MAMLModel-199"><span class="linenos">199</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
</span><span id="MAMLModel-200"><a href="#MAMLModel-200"><span class="linenos">200</span></a>                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MAMLModel-201"><a href="#MAMLModel-201"><span class="linenos">201</span></a>                        <span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
</span><span id="MAMLModel-202"><a href="#MAMLModel-202"><span class="linenos">202</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MAMLModel-203"><a href="#MAMLModel-203"><span class="linenos">203</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
</span><span id="MAMLModel-204"><a href="#MAMLModel-204"><span class="linenos">204</span></a>                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MAMLModel-205"><a href="#MAMLModel-205"><span class="linenos">205</span></a>                        <span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
</span><span id="MAMLModel-206"><a href="#MAMLModel-206"><span class="linenos">206</span></a>
</span><span id="MAMLModel-207"><a href="#MAMLModel-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
</span><span id="MAMLModel-208"><a href="#MAMLModel-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;override this function since initial parameters will return with a generator.</span>
</span><span id="MAMLModel-209"><a href="#MAMLModel-209"><span class="linenos">209</span></a>
</span><span id="MAMLModel-210"><a href="#MAMLModel-210"><span class="linenos">210</span></a><span class="sd">        Returns</span>
</span><span id="MAMLModel-211"><a href="#MAMLModel-211"><span class="linenos">211</span></a><span class="sd">        -------</span>
</span><span id="MAMLModel-212"><a href="#MAMLModel-212"><span class="linenos">212</span></a><span class="sd">        Union[ParameterList, list]</span>
</span><span id="MAMLModel-213"><a href="#MAMLModel-213"><span class="linenos">213</span></a><span class="sd">            The parameters of the model</span>
</span><span id="MAMLModel-214"><a href="#MAMLModel-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="MAMLModel-215"><a href="#MAMLModel-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
</span></pre></div>


            <div class="docstring"><p>Class of <code>torch.nn.Module</code> objects that are to be trained using MAML.
The architecture needs to be defined as list of tuples. And other
attributes need to be defines as shown in the following example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">class</span> <span class="nc">ForMiniimagenet</span><span class="p">(</span><span class="n">MAMLModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;conv2d&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;bn&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">32</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;max_pool2d&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;conv2d&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;bn&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">32</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;max_pool2d&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;conv2d&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;bn&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">32</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;max_pool2d&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;conv2d&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;bn&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">32</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;max_pool2d&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span>
            <span class="p">(</span><span class="s1">&#39;flatten&#39;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span> <span class="o">=</span> <span class="n">modelParametersInitializer</span><span class="p">(</span><span class="n">architecture</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
</code></pre>
</div>
</div>


                            <div id="MAMLModel.__init__" class="classattr">
                                        <input id="MAMLModel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MAMLModel</span><span class="signature pdoc-code condensed">()</span>

                <label class="view-source-button" for="MAMLModel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MAMLModel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MAMLModel.__init__-46"><a href="#MAMLModel.__init__-46"><span class="linenos">46</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MAMLModel.__init__-47"><a href="#MAMLModel.__init__-47"><span class="linenos">47</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="MAMLModel.__init__-48"><a href="#MAMLModel.__init__-48"><span class="linenos">48</span></a>        <span class="c1"># this dict contains all tensors needed to be optimized</span>
</span><span id="MAMLModel.__init__-49"><a href="#MAMLModel.__init__-49"><span class="linenos">49</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParameterList</span><span class="p">()</span>
</span><span id="MAMLModel.__init__-50"><a href="#MAMLModel.__init__-50"><span class="linenos">50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;parameters of model&quot;&quot;&quot;</span>
</span><span id="MAMLModel.__init__-51"><a href="#MAMLModel.__init__-51"><span class="linenos">51</span></a>        <span class="c1"># running_mean and running_var</span>
</span><span id="MAMLModel.__init__-52"><a href="#MAMLModel.__init__-52"><span class="linenos">52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="n">ParameterList</span><span class="p">()</span>
</span><span id="MAMLModel.__init__-53"><a href="#MAMLModel.__init__-53"><span class="linenos">53</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;running_mean and running_var for batch norm&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Initializes internal Module state, shared by both nn.Module and ScriptModule.</p>
</div>


                            </div>
                            <div id="MAMLModel.vars" class="classattr">
                                <div class="attr variable">
            <span class="name">vars</span><span class="annotation">: Union[torch.nn.modules.container.ParameterList, list]</span>

        
    </div>
    <a class="headerlink" href="#MAMLModel.vars"></a>
    
            <div class="docstring"><p>parameters of model</p>
</div>


                            </div>
                            <div id="MAMLModel.vars_bn" class="classattr">
                                <div class="attr variable">
            <span class="name">vars_bn</span><span class="annotation">: Union[torch.nn.modules.container.ParameterList, list]</span>

        
    </div>
    <a class="headerlink" href="#MAMLModel.vars_bn"></a>
    
            <div class="docstring"><p>running_mean and running_var for batch norm</p>
</div>


                            </div>
                            <div id="MAMLModel.forward" class="classattr">
                                        <input id="MAMLModel.forward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">forward</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>,</span><span class="param">	<span class="nb">vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span>,</span><span class="param">	<span class="n">bn_training</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>:</span></span>

                <label class="view-source-button" for="MAMLModel.forward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MAMLModel.forward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MAMLModel.forward-55"><a href="#MAMLModel.forward-55"><span class="linenos"> 55</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="nb">vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span> <span class="n">bn_training</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
</span><span id="MAMLModel.forward-56"><a href="#MAMLModel.forward-56"><span class="linenos"> 56</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to run forward pass</span>
</span><span id="MAMLModel.forward-57"><a href="#MAMLModel.forward-57"><span class="linenos"> 57</span></a>
</span><span id="MAMLModel.forward-58"><a href="#MAMLModel.forward-58"><span class="linenos"> 58</span></a><span class="sd">        Parameters</span>
</span><span id="MAMLModel.forward-59"><a href="#MAMLModel.forward-59"><span class="linenos"> 59</span></a><span class="sd">        ----------</span>
</span><span id="MAMLModel.forward-60"><a href="#MAMLModel.forward-60"><span class="linenos"> 60</span></a><span class="sd">        x : Tensor</span>
</span><span id="MAMLModel.forward-61"><a href="#MAMLModel.forward-61"><span class="linenos"> 61</span></a><span class="sd">            input</span>
</span><span id="MAMLModel.forward-62"><a href="#MAMLModel.forward-62"><span class="linenos"> 62</span></a><span class="sd">        vars : Union[ParameterList, list]</span>
</span><span id="MAMLModel.forward-63"><a href="#MAMLModel.forward-63"><span class="linenos"> 63</span></a><span class="sd">            parameters (or fast parameters)</span>
</span><span id="MAMLModel.forward-64"><a href="#MAMLModel.forward-64"><span class="linenos"> 64</span></a><span class="sd">        bn_training : bool, optional</span>
</span><span id="MAMLModel.forward-65"><a href="#MAMLModel.forward-65"><span class="linenos"> 65</span></a><span class="sd">            To enable of disable batch norm training, by default True</span>
</span><span id="MAMLModel.forward-66"><a href="#MAMLModel.forward-66"><span class="linenos"> 66</span></a>
</span><span id="MAMLModel.forward-67"><a href="#MAMLModel.forward-67"><span class="linenos"> 67</span></a><span class="sd">        Returns</span>
</span><span id="MAMLModel.forward-68"><a href="#MAMLModel.forward-68"><span class="linenos"> 68</span></a><span class="sd">        -------</span>
</span><span id="MAMLModel.forward-69"><a href="#MAMLModel.forward-69"><span class="linenos"> 69</span></a><span class="sd">        Tensor</span>
</span><span id="MAMLModel.forward-70"><a href="#MAMLModel.forward-70"><span class="linenos"> 70</span></a><span class="sd">            Output</span>
</span><span id="MAMLModel.forward-71"><a href="#MAMLModel.forward-71"><span class="linenos"> 71</span></a>
</span><span id="MAMLModel.forward-72"><a href="#MAMLModel.forward-72"><span class="linenos"> 72</span></a><span class="sd">        Raises</span>
</span><span id="MAMLModel.forward-73"><a href="#MAMLModel.forward-73"><span class="linenos"> 73</span></a><span class="sd">        ------</span>
</span><span id="MAMLModel.forward-74"><a href="#MAMLModel.forward-74"><span class="linenos"> 74</span></a><span class="sd">        NotImplementedError</span>
</span><span id="MAMLModel.forward-75"><a href="#MAMLModel.forward-75"><span class="linenos"> 75</span></a><span class="sd">            Raised when architecture component is not defined</span>
</span><span id="MAMLModel.forward-76"><a href="#MAMLModel.forward-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>              
</span><span id="MAMLModel.forward-77"><a href="#MAMLModel.forward-77"><span class="linenos"> 77</span></a>        <span class="k">if</span> <span class="nb">vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MAMLModel.forward-78"><a href="#MAMLModel.forward-78"><span class="linenos"> 78</span></a>            <span class="nb">vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
</span><span id="MAMLModel.forward-79"><a href="#MAMLModel.forward-79"><span class="linenos"> 79</span></a>        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MAMLModel.forward-80"><a href="#MAMLModel.forward-80"><span class="linenos"> 80</span></a>        <span class="n">bn_idx</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MAMLModel.forward-81"><a href="#MAMLModel.forward-81"><span class="linenos"> 81</span></a>
</span><span id="MAMLModel.forward-82"><a href="#MAMLModel.forward-82"><span class="linenos"> 82</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
</span><span id="MAMLModel.forward-83"><a href="#MAMLModel.forward-83"><span class="linenos"> 83</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;conv2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-84"><a href="#MAMLModel.forward-84"><span class="linenos"> 84</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel.forward-85"><a href="#MAMLModel.forward-85"><span class="linenos"> 85</span></a>                <span class="c1"># remember to keep synchrozied of forward_encoder and forward_decoder!</span>
</span><span id="MAMLModel.forward-86"><a href="#MAMLModel.forward-86"><span class="linenos"> 86</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">groups</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="MAMLModel.forward-87"><a href="#MAMLModel.forward-87"><span class="linenos"> 87</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel.forward-88"><a href="#MAMLModel.forward-88"><span class="linenos"> 88</span></a>                <span class="c1"># print(name, param, &#39;\tout:&#39;, x.shape)</span>
</span><span id="MAMLModel.forward-89"><a href="#MAMLModel.forward-89"><span class="linenos"> 89</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;convt2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-90"><a href="#MAMLModel.forward-90"><span class="linenos"> 90</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel.forward-91"><a href="#MAMLModel.forward-91"><span class="linenos"> 91</span></a>                <span class="c1"># remember to keep synchrozied of forward_encoder and forward_decoder!</span>
</span><span id="MAMLModel.forward-92"><a href="#MAMLModel.forward-92"><span class="linenos"> 92</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">conv_transpose2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">padding</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">groups</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="MAMLModel.forward-93"><a href="#MAMLModel.forward-93"><span class="linenos"> 93</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel.forward-94"><a href="#MAMLModel.forward-94"><span class="linenos"> 94</span></a>                <span class="c1"># print(name, param, &#39;\tout:&#39;, x.shape)</span>
</span><span id="MAMLModel.forward-95"><a href="#MAMLModel.forward-95"><span class="linenos"> 95</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-96"><a href="#MAMLModel.forward-96"><span class="linenos"> 96</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel.forward-97"><a href="#MAMLModel.forward-97"><span class="linenos"> 97</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="MAMLModel.forward-98"><a href="#MAMLModel.forward-98"><span class="linenos"> 98</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel.forward-99"><a href="#MAMLModel.forward-99"><span class="linenos"> 99</span></a>                <span class="c1"># print(&#39;forward:&#39;, idx, x.norm().item())</span>
</span><span id="MAMLModel.forward-100"><a href="#MAMLModel.forward-100"><span class="linenos">100</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;bn&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-101"><a href="#MAMLModel.forward-101"><span class="linenos">101</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel.forward-102"><a href="#MAMLModel.forward-102"><span class="linenos">102</span></a>                <span class="n">running_mean</span><span class="p">,</span> <span class="n">running_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">[</span><span class="n">bn_idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">[</span><span class="n">bn_idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel.forward-103"><a href="#MAMLModel.forward-103"><span class="linenos">103</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">batch_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">running_mean</span><span class="p">,</span> <span class="n">running_var</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="n">bn_training</span><span class="p">)</span>
</span><span id="MAMLModel.forward-104"><a href="#MAMLModel.forward-104"><span class="linenos">104</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel.forward-105"><a href="#MAMLModel.forward-105"><span class="linenos">105</span></a>                <span class="n">bn_idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel.forward-106"><a href="#MAMLModel.forward-106"><span class="linenos">106</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;ln&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-107"><a href="#MAMLModel.forward-107"><span class="linenos">107</span></a>                <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="nb">vars</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLModel.forward-108"><a href="#MAMLModel.forward-108"><span class="linenos">108</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">layer_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="MAMLModel.forward-109"><a href="#MAMLModel.forward-109"><span class="linenos">109</span></a>                <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="MAMLModel.forward-110"><a href="#MAMLModel.forward-110"><span class="linenos">110</span></a>
</span><span id="MAMLModel.forward-111"><a href="#MAMLModel.forward-111"><span class="linenos">111</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;flatten&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-112"><a href="#MAMLModel.forward-112"><span class="linenos">112</span></a>                <span class="c1"># print(x.shape)</span>
</span><span id="MAMLModel.forward-113"><a href="#MAMLModel.forward-113"><span class="linenos">113</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MAMLModel.forward-114"><a href="#MAMLModel.forward-114"><span class="linenos">114</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;reshape&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-115"><a href="#MAMLModel.forward-115"><span class="linenos">115</span></a>                <span class="c1"># [b, 8] =&gt; [b, 2, 2, 2]</span>
</span><span id="MAMLModel.forward-116"><a href="#MAMLModel.forward-116"><span class="linenos">116</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">*</span><span class="n">param</span><span class="p">)</span>
</span><span id="MAMLModel.forward-117"><a href="#MAMLModel.forward-117"><span class="linenos">117</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;relu&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-118"><a href="#MAMLModel.forward-118"><span class="linenos">118</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLModel.forward-119"><a href="#MAMLModel.forward-119"><span class="linenos">119</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;leakyrelu&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-120"><a href="#MAMLModel.forward-120"><span class="linenos">120</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">leaky_relu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">negative_slope</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="MAMLModel.forward-121"><a href="#MAMLModel.forward-121"><span class="linenos">121</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;tanh&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-122"><a href="#MAMLModel.forward-122"><span class="linenos">122</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="MAMLModel.forward-123"><a href="#MAMLModel.forward-123"><span class="linenos">123</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-124"><a href="#MAMLModel.forward-124"><span class="linenos">124</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="MAMLModel.forward-125"><a href="#MAMLModel.forward-125"><span class="linenos">125</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;upsample&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-126"><a href="#MAMLModel.forward-126"><span class="linenos">126</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">upsample_nearest</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLModel.forward-127"><a href="#MAMLModel.forward-127"><span class="linenos">127</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;max_pool2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-128"><a href="#MAMLModel.forward-128"><span class="linenos">128</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">max_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MAMLModel.forward-129"><a href="#MAMLModel.forward-129"><span class="linenos">129</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;avg_pool2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-130"><a href="#MAMLModel.forward-130"><span class="linenos">130</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">avg_pool2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="MAMLModel.forward-131"><a href="#MAMLModel.forward-131"><span class="linenos">131</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dropout&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-132"><a href="#MAMLModel.forward-132"><span class="linenos">132</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bn_training</span><span class="p">)</span>
</span><span id="MAMLModel.forward-133"><a href="#MAMLModel.forward-133"><span class="linenos">133</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;unsqueeze&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-134"><a href="#MAMLModel.forward-134"><span class="linenos">134</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">unsqueeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLModel.forward-135"><a href="#MAMLModel.forward-135"><span class="linenos">135</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;elu&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.forward-136"><a href="#MAMLModel.forward-136"><span class="linenos">136</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">elu</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="MAMLModel.forward-137"><a href="#MAMLModel.forward-137"><span class="linenos">137</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MAMLModel.forward-138"><a href="#MAMLModel.forward-138"><span class="linenos">138</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="MAMLModel.forward-139"><a href="#MAMLModel.forward-139"><span class="linenos">139</span></a>
</span><span id="MAMLModel.forward-140"><a href="#MAMLModel.forward-140"><span class="linenos">140</span></a>        <span class="c1"># make sure variable is used properly</span>
</span><span id="MAMLModel.forward-141"><a href="#MAMLModel.forward-141"><span class="linenos">141</span></a>        <span class="k">assert</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">vars</span><span class="p">)</span>
</span><span id="MAMLModel.forward-142"><a href="#MAMLModel.forward-142"><span class="linenos">142</span></a>        <span class="k">assert</span> <span class="n">bn_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vars_bn</span><span class="p">)</span>
</span><span id="MAMLModel.forward-143"><a href="#MAMLModel.forward-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="n">x</span>
</span></pre></div>


            <div class="docstring"><p>Method to run forward pass</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (Tensor):
input</li>
<li><strong>vars</strong> (Union[ParameterList, list]):
parameters (or fast parameters)</li>
<li><strong>bn_training</strong> (bool, optional):
To enable of disable batch norm training, by default True</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Tensor</strong>: Output</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>NotImplementedError</strong>: Raised when architecture component is not defined</li>
</ul>
</div>


                            </div>
                            <div id="MAMLModel.extra_repr" class="classattr">
                                        <input id="MAMLModel.extra_repr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extra_repr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="MAMLModel.extra_repr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MAMLModel.extra_repr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MAMLModel.extra_repr-145"><a href="#MAMLModel.extra_repr-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">extra_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MAMLModel.extra_repr-146"><a href="#MAMLModel.extra_repr-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for custom representation</span>
</span><span id="MAMLModel.extra_repr-147"><a href="#MAMLModel.extra_repr-147"><span class="linenos">147</span></a>
</span><span id="MAMLModel.extra_repr-148"><a href="#MAMLModel.extra_repr-148"><span class="linenos">148</span></a><span class="sd">        Returns</span>
</span><span id="MAMLModel.extra_repr-149"><a href="#MAMLModel.extra_repr-149"><span class="linenos">149</span></a><span class="sd">        -------</span>
</span><span id="MAMLModel.extra_repr-150"><a href="#MAMLModel.extra_repr-150"><span class="linenos">150</span></a><span class="sd">        str</span>
</span><span id="MAMLModel.extra_repr-151"><a href="#MAMLModel.extra_repr-151"><span class="linenos">151</span></a><span class="sd">            string representation</span>
</span><span id="MAMLModel.extra_repr-152"><a href="#MAMLModel.extra_repr-152"><span class="linenos">152</span></a>
</span><span id="MAMLModel.extra_repr-153"><a href="#MAMLModel.extra_repr-153"><span class="linenos">153</span></a><span class="sd">        Raises</span>
</span><span id="MAMLModel.extra_repr-154"><a href="#MAMLModel.extra_repr-154"><span class="linenos">154</span></a><span class="sd">        ------</span>
</span><span id="MAMLModel.extra_repr-155"><a href="#MAMLModel.extra_repr-155"><span class="linenos">155</span></a><span class="sd">        NotImplementedError</span>
</span><span id="MAMLModel.extra_repr-156"><a href="#MAMLModel.extra_repr-156"><span class="linenos">156</span></a><span class="sd">            Raised when architecture component is not defined</span>
</span><span id="MAMLModel.extra_repr-157"><a href="#MAMLModel.extra_repr-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="MAMLModel.extra_repr-158"><a href="#MAMLModel.extra_repr-158"><span class="linenos">158</span></a>        <span class="n">info</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="MAMLModel.extra_repr-159"><a href="#MAMLModel.extra_repr-159"><span class="linenos">159</span></a>
</span><span id="MAMLModel.extra_repr-160"><a href="#MAMLModel.extra_repr-160"><span class="linenos">160</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
</span><span id="MAMLModel.extra_repr-161"><a href="#MAMLModel.extra_repr-161"><span class="linenos">161</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;conv2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.extra_repr-162"><a href="#MAMLModel.extra_repr-162"><span class="linenos">162</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;conv2d:(ch_in:</span><span class="si">%d</span><span class="s1">, ch_out:</span><span class="si">%d</span><span class="s1">, k:</span><span class="si">%d</span><span class="s1">x</span><span class="si">%d</span><span class="s1">, stride:</span><span class="si">%d</span><span class="s1">, padding:</span><span class="si">%s</span><span class="s1">, groups:</span><span class="si">%d</span><span class="s1">)&#39;</span>\
</span><span id="MAMLModel.extra_repr-163"><a href="#MAMLModel.extra_repr-163"><span class="linenos">163</span></a>                      <span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="MAMLModel.extra_repr-164"><a href="#MAMLModel.extra_repr-164"><span class="linenos">164</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel.extra_repr-165"><a href="#MAMLModel.extra_repr-165"><span class="linenos">165</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;convt2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.extra_repr-166"><a href="#MAMLModel.extra_repr-166"><span class="linenos">166</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;convTranspose2d:(ch_in:</span><span class="si">%d</span><span class="s1">, ch_out:</span><span class="si">%d</span><span class="s1">, k:</span><span class="si">%d</span><span class="s1">x</span><span class="si">%d</span><span class="s1">, stride:</span><span class="si">%d</span><span class="s1">, padding:</span><span class="si">%s</span><span class="s1">, groups:</span><span class="si">%d</span><span class="s1">)&#39;</span>\
</span><span id="MAMLModel.extra_repr-167"><a href="#MAMLModel.extra_repr-167"><span class="linenos">167</span></a>                      <span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="n">param</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
</span><span id="MAMLModel.extra_repr-168"><a href="#MAMLModel.extra_repr-168"><span class="linenos">168</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel.extra_repr-169"><a href="#MAMLModel.extra_repr-169"><span class="linenos">169</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.extra_repr-170"><a href="#MAMLModel.extra_repr-170"><span class="linenos">170</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;linear:(in:</span><span class="si">%d</span><span class="s1">, out:</span><span class="si">%d</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLModel.extra_repr-171"><a href="#MAMLModel.extra_repr-171"><span class="linenos">171</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel.extra_repr-172"><a href="#MAMLModel.extra_repr-172"><span class="linenos">172</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;leakyrelu&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.extra_repr-173"><a href="#MAMLModel.extra_repr-173"><span class="linenos">173</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;leakyrelu:(slope:</span><span class="si">%f</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLModel.extra_repr-174"><a href="#MAMLModel.extra_repr-174"><span class="linenos">174</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel.extra_repr-175"><a href="#MAMLModel.extra_repr-175"><span class="linenos">175</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;avg_pool2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.extra_repr-176"><a href="#MAMLModel.extra_repr-176"><span class="linenos">176</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;avg_pool2d:(k:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, stride:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, padding:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="MAMLModel.extra_repr-177"><a href="#MAMLModel.extra_repr-177"><span class="linenos">177</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel.extra_repr-178"><a href="#MAMLModel.extra_repr-178"><span class="linenos">178</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;max_pool2d&#39;</span><span class="p">:</span>
</span><span id="MAMLModel.extra_repr-179"><a href="#MAMLModel.extra_repr-179"><span class="linenos">179</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;max_pool2d:(k:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, stride:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, padding:</span><span class="si">{</span><span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="MAMLModel.extra_repr-180"><a href="#MAMLModel.extra_repr-180"><span class="linenos">180</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel.extra_repr-181"><a href="#MAMLModel.extra_repr-181"><span class="linenos">181</span></a>            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;flatten&#39;</span><span class="p">,</span> <span class="s1">&#39;tanh&#39;</span><span class="p">,</span> <span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="s1">&#39;upsample&#39;</span><span class="p">,</span> <span class="s1">&#39;reshape&#39;</span><span class="p">,</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">,</span> <span class="s1">&#39;use_logits&#39;</span><span class="p">,</span> <span class="s1">&#39;bn&#39;</span><span class="p">,</span> <span class="s1">&#39;ln&#39;</span><span class="p">,</span> <span class="s1">&#39;dropout&#39;</span><span class="p">,</span> <span class="s1">&#39;unsqueeze&#39;</span><span class="p">,</span> <span class="s1">&#39;elu&#39;</span><span class="p">]:</span>
</span><span id="MAMLModel.extra_repr-182"><a href="#MAMLModel.extra_repr-182"><span class="linenos">182</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">param</span><span class="p">))</span>
</span><span id="MAMLModel.extra_repr-183"><a href="#MAMLModel.extra_repr-183"><span class="linenos">183</span></a>                <span class="n">info</span> <span class="o">+=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="MAMLModel.extra_repr-184"><a href="#MAMLModel.extra_repr-184"><span class="linenos">184</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MAMLModel.extra_repr-185"><a href="#MAMLModel.extra_repr-185"><span class="linenos">185</span></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="MAMLModel.extra_repr-186"><a href="#MAMLModel.extra_repr-186"><span class="linenos">186</span></a>
</span><span id="MAMLModel.extra_repr-187"><a href="#MAMLModel.extra_repr-187"><span class="linenos">187</span></a>        <span class="k">return</span> <span class="n">info</span>
</span></pre></div>


            <div class="docstring"><p>Method for custom representation</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>str</strong>: string representation</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>NotImplementedError</strong>: Raised when architecture component is not defined</li>
</ul>
</div>


                            </div>
                            <div id="MAMLModel.zero_grad" class="classattr">
                                        <input id="MAMLModel.zero_grad-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">zero_grad</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="nb">vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MAMLModel.zero_grad-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MAMLModel.zero_grad"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MAMLModel.zero_grad-189"><a href="#MAMLModel.zero_grad-189"><span class="linenos">189</span></a>    <span class="k">def</span> <span class="nf">zero_grad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">vars</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MAMLModel.zero_grad-190"><a href="#MAMLModel.zero_grad-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Custom method to make gradients of custom parameters zero</span>
</span><span id="MAMLModel.zero_grad-191"><a href="#MAMLModel.zero_grad-191"><span class="linenos">191</span></a>
</span><span id="MAMLModel.zero_grad-192"><a href="#MAMLModel.zero_grad-192"><span class="linenos">192</span></a><span class="sd">        Parameters</span>
</span><span id="MAMLModel.zero_grad-193"><a href="#MAMLModel.zero_grad-193"><span class="linenos">193</span></a><span class="sd">        ----------</span>
</span><span id="MAMLModel.zero_grad-194"><a href="#MAMLModel.zero_grad-194"><span class="linenos">194</span></a><span class="sd">        vars : Union[ParameterList, list], optional</span>
</span><span id="MAMLModel.zero_grad-195"><a href="#MAMLModel.zero_grad-195"><span class="linenos">195</span></a><span class="sd">            Parameters (or fast parameters), by default None</span>
</span><span id="MAMLModel.zero_grad-196"><a href="#MAMLModel.zero_grad-196"><span class="linenos">196</span></a><span class="sd">        &quot;&quot;&quot;</span>              
</span><span id="MAMLModel.zero_grad-197"><a href="#MAMLModel.zero_grad-197"><span class="linenos">197</span></a>        <span class="k">with</span> <span class="n">no_grad</span><span class="p">():</span>
</span><span id="MAMLModel.zero_grad-198"><a href="#MAMLModel.zero_grad-198"><span class="linenos">198</span></a>            <span class="k">if</span> <span class="nb">vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MAMLModel.zero_grad-199"><a href="#MAMLModel.zero_grad-199"><span class="linenos">199</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span><span class="p">:</span>
</span><span id="MAMLModel.zero_grad-200"><a href="#MAMLModel.zero_grad-200"><span class="linenos">200</span></a>                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MAMLModel.zero_grad-201"><a href="#MAMLModel.zero_grad-201"><span class="linenos">201</span></a>                        <span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
</span><span id="MAMLModel.zero_grad-202"><a href="#MAMLModel.zero_grad-202"><span class="linenos">202</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MAMLModel.zero_grad-203"><a href="#MAMLModel.zero_grad-203"><span class="linenos">203</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">:</span>
</span><span id="MAMLModel.zero_grad-204"><a href="#MAMLModel.zero_grad-204"><span class="linenos">204</span></a>                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MAMLModel.zero_grad-205"><a href="#MAMLModel.zero_grad-205"><span class="linenos">205</span></a>                        <span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Custom method to make gradients of custom parameters zero</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>vars</strong> (Union[ParameterList, list], optional):
Parameters (or fast parameters), by default None</li>
</ul>
</div>


                            </div>
                            <div id="MAMLModel.parameters" class="classattr">
                                        <input id="MAMLModel.parameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parameters</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MAMLModel.parameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MAMLModel.parameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MAMLModel.parameters-207"><a href="#MAMLModel.parameters-207"><span class="linenos">207</span></a>    <span class="k">def</span> <span class="nf">parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">ParameterList</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
</span><span id="MAMLModel.parameters-208"><a href="#MAMLModel.parameters-208"><span class="linenos">208</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;override this function since initial parameters will return with a generator.</span>
</span><span id="MAMLModel.parameters-209"><a href="#MAMLModel.parameters-209"><span class="linenos">209</span></a>
</span><span id="MAMLModel.parameters-210"><a href="#MAMLModel.parameters-210"><span class="linenos">210</span></a><span class="sd">        Returns</span>
</span><span id="MAMLModel.parameters-211"><a href="#MAMLModel.parameters-211"><span class="linenos">211</span></a><span class="sd">        -------</span>
</span><span id="MAMLModel.parameters-212"><a href="#MAMLModel.parameters-212"><span class="linenos">212</span></a><span class="sd">        Union[ParameterList, list]</span>
</span><span id="MAMLModel.parameters-213"><a href="#MAMLModel.parameters-213"><span class="linenos">213</span></a><span class="sd">            The parameters of the model</span>
</span><span id="MAMLModel.parameters-214"><a href="#MAMLModel.parameters-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="MAMLModel.parameters-215"><a href="#MAMLModel.parameters-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vars</span>
</span></pre></div>


            <div class="docstring"><p>override this function since initial parameters will return with a generator.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>Union[ParameterList, list]</strong>: The parameters of the model</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>torch.nn.modules.module.Module</dt>
                                <dd id="MAMLModel.dump_patches" class="variable">dump_patches</dd>
                <dd id="MAMLModel.training" class="variable">training</dd>
                <dd id="MAMLModel.call_super_init" class="variable">call_super_init</dd>
                <dd id="MAMLModel.register_buffer" class="function">register_buffer</dd>
                <dd id="MAMLModel.register_parameter" class="function">register_parameter</dd>
                <dd id="MAMLModel.add_module" class="function">add_module</dd>
                <dd id="MAMLModel.register_module" class="function">register_module</dd>
                <dd id="MAMLModel.get_submodule" class="function">get_submodule</dd>
                <dd id="MAMLModel.get_parameter" class="function">get_parameter</dd>
                <dd id="MAMLModel.get_buffer" class="function">get_buffer</dd>
                <dd id="MAMLModel.get_extra_state" class="function">get_extra_state</dd>
                <dd id="MAMLModel.set_extra_state" class="function">set_extra_state</dd>
                <dd id="MAMLModel.apply" class="function">apply</dd>
                <dd id="MAMLModel.cuda" class="function">cuda</dd>
                <dd id="MAMLModel.ipu" class="function">ipu</dd>
                <dd id="MAMLModel.xpu" class="function">xpu</dd>
                <dd id="MAMLModel.cpu" class="function">cpu</dd>
                <dd id="MAMLModel.type" class="function">type</dd>
                <dd id="MAMLModel.float" class="function">float</dd>
                <dd id="MAMLModel.double" class="function">double</dd>
                <dd id="MAMLModel.half" class="function">half</dd>
                <dd id="MAMLModel.bfloat16" class="function">bfloat16</dd>
                <dd id="MAMLModel.to_empty" class="function">to_empty</dd>
                <dd id="MAMLModel.to" class="function">to</dd>
                <dd id="MAMLModel.register_full_backward_pre_hook" class="function">register_full_backward_pre_hook</dd>
                <dd id="MAMLModel.register_backward_hook" class="function">register_backward_hook</dd>
                <dd id="MAMLModel.register_full_backward_hook" class="function">register_full_backward_hook</dd>
                <dd id="MAMLModel.register_forward_pre_hook" class="function">register_forward_pre_hook</dd>
                <dd id="MAMLModel.register_forward_hook" class="function">register_forward_hook</dd>
                <dd id="MAMLModel.register_state_dict_pre_hook" class="function">register_state_dict_pre_hook</dd>
                <dd id="MAMLModel.state_dict" class="function">state_dict</dd>
                <dd id="MAMLModel.register_load_state_dict_post_hook" class="function">register_load_state_dict_post_hook</dd>
                <dd id="MAMLModel.load_state_dict" class="function">load_state_dict</dd>
                <dd id="MAMLModel.named_parameters" class="function">named_parameters</dd>
                <dd id="MAMLModel.buffers" class="function">buffers</dd>
                <dd id="MAMLModel.named_buffers" class="function">named_buffers</dd>
                <dd id="MAMLModel.children" class="function">children</dd>
                <dd id="MAMLModel.named_children" class="function">named_children</dd>
                <dd id="MAMLModel.modules" class="function">modules</dd>
                <dd id="MAMLModel.named_modules" class="function">named_modules</dd>
                <dd id="MAMLModel.train" class="function">train</dd>
                <dd id="MAMLModel.eval" class="function">eval</dd>
                <dd id="MAMLModel.requires_grad_" class="function">requires_grad_</dd>
                <dd id="MAMLModel.share_memory" class="function">share_memory</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MAMLHandler">
                            <input id="MAMLHandler-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MAMLHandler</span>:

                <label class="view-source-button" for="MAMLHandler-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MAMLHandler"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MAMLHandler-217"><a href="#MAMLHandler-217"><span class="linenos">217</span></a><span class="k">class</span> <span class="nc">MAMLHandler</span><span class="p">:</span>
</span><span id="MAMLHandler-218"><a href="#MAMLHandler-218"><span class="linenos">218</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper class to train a model using Meta Agnostic Meta Learning</span>
</span><span id="MAMLHandler-219"><a href="#MAMLHandler-219"><span class="linenos">219</span></a><span class="sd">    &quot;&quot;&quot;</span>    
</span><span id="MAMLHandler-220"><a href="#MAMLHandler-220"><span class="linenos">220</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="MAMLHandler-221"><a href="#MAMLHandler-221"><span class="linenos">221</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">trainDataLoader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span>
</span><span id="MAMLHandler-222"><a href="#MAMLHandler-222"><span class="linenos">222</span></a>            <span class="n">validationDataLoader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">updateStepsInInnerLoopTrain</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MAMLHandler-223"><a href="#MAMLHandler-223"><span class="linenos">223</span></a>            <span class="n">updateStepsInInnerLoopValid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">adaptLearningRate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MAMLHandler-224"><a href="#MAMLHandler-224"><span class="linenos">224</span></a>            <span class="n">optimizer</span><span class="p">,</span> <span class="n">live</span><span class="p">:</span> <span class="n">Live</span><span class="p">,</span> <span class="n">modelSaveDir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">modelName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MAMLHandler-225"><a href="#MAMLHandler-225"><span class="linenos">225</span></a>    <span class="p">):</span>
</span><span id="MAMLHandler-226"><a href="#MAMLHandler-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-227"><a href="#MAMLHandler-227"><span class="linenos">227</span></a><span class="sd">        Creating an object of MAMLHandler class.</span>
</span><span id="MAMLHandler-228"><a href="#MAMLHandler-228"><span class="linenos">228</span></a>
</span><span id="MAMLHandler-229"><a href="#MAMLHandler-229"><span class="linenos">229</span></a><span class="sd">        Parameters</span>
</span><span id="MAMLHandler-230"><a href="#MAMLHandler-230"><span class="linenos">230</span></a><span class="sd">        ----------</span>
</span><span id="MAMLHandler-231"><a href="#MAMLHandler-231"><span class="linenos">231</span></a><span class="sd">        model : Module</span>
</span><span id="MAMLHandler-232"><a href="#MAMLHandler-232"><span class="linenos">232</span></a><span class="sd">            Model to be trained</span>
</span><span id="MAMLHandler-233"><a href="#MAMLHandler-233"><span class="linenos">233</span></a><span class="sd">        device : int</span>
</span><span id="MAMLHandler-234"><a href="#MAMLHandler-234"><span class="linenos">234</span></a><span class="sd">            device id</span>
</span><span id="MAMLHandler-235"><a href="#MAMLHandler-235"><span class="linenos">235</span></a><span class="sd">        trainDataLoader : DataLoader</span>
</span><span id="MAMLHandler-236"><a href="#MAMLHandler-236"><span class="linenos">236</span></a><span class="sd">            train data loader</span>
</span><span id="MAMLHandler-237"><a href="#MAMLHandler-237"><span class="linenos">237</span></a><span class="sd">        validationDataLoader : DataLoader</span>
</span><span id="MAMLHandler-238"><a href="#MAMLHandler-238"><span class="linenos">238</span></a><span class="sd">            validation data loader</span>
</span><span id="MAMLHandler-239"><a href="#MAMLHandler-239"><span class="linenos">239</span></a><span class="sd">        updateStepsInInnerLoopTrain : int</span>
</span><span id="MAMLHandler-240"><a href="#MAMLHandler-240"><span class="linenos">240</span></a><span class="sd">            number of gradient update steps while training</span>
</span><span id="MAMLHandler-241"><a href="#MAMLHandler-241"><span class="linenos">241</span></a><span class="sd">        updateStepsInInnerLoopTest : int</span>
</span><span id="MAMLHandler-242"><a href="#MAMLHandler-242"><span class="linenos">242</span></a><span class="sd">            number of gradient update steps while validation</span>
</span><span id="MAMLHandler-243"><a href="#MAMLHandler-243"><span class="linenos">243</span></a><span class="sd">        adaptLearningRate : float</span>
</span><span id="MAMLHandler-244"><a href="#MAMLHandler-244"><span class="linenos">244</span></a><span class="sd">            learning while adapting (inner loop)</span>
</span><span id="MAMLHandler-245"><a href="#MAMLHandler-245"><span class="linenos">245</span></a><span class="sd">        epochs : int</span>
</span><span id="MAMLHandler-246"><a href="#MAMLHandler-246"><span class="linenos">246</span></a><span class="sd">            number of epochs</span>
</span><span id="MAMLHandler-247"><a href="#MAMLHandler-247"><span class="linenos">247</span></a><span class="sd">        optimizer : torch.optim.Optimizer</span>
</span><span id="MAMLHandler-248"><a href="#MAMLHandler-248"><span class="linenos">248</span></a><span class="sd">            Optimizer to be used</span>
</span><span id="MAMLHandler-249"><a href="#MAMLHandler-249"><span class="linenos">249</span></a><span class="sd">        live : dvclive.Live</span>
</span><span id="MAMLHandler-250"><a href="#MAMLHandler-250"><span class="linenos">250</span></a><span class="sd">            A DVC live object for logging</span>
</span><span id="MAMLHandler-251"><a href="#MAMLHandler-251"><span class="linenos">251</span></a><span class="sd">        modelSaveDir : str, optional</span>
</span><span id="MAMLHandler-252"><a href="#MAMLHandler-252"><span class="linenos">252</span></a><span class="sd">            dir path to stoe model, by default None</span>
</span><span id="MAMLHandler-253"><a href="#MAMLHandler-253"><span class="linenos">253</span></a><span class="sd">        modelName : str, optional</span>
</span><span id="MAMLHandler-254"><a href="#MAMLHandler-254"><span class="linenos">254</span></a><span class="sd">            Name of model when saved</span>
</span><span id="MAMLHandler-255"><a href="#MAMLHandler-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>             
</span><span id="MAMLHandler-256"><a href="#MAMLHandler-256"><span class="linenos">256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span> <span class="n">Module</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="MAMLHandler-257"><a href="#MAMLHandler-257"><span class="linenos">257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided model during object creation&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-258"><a href="#MAMLHandler-258"><span class="linenos">258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="MAMLHandler-259"><a href="#MAMLHandler-259"><span class="linenos">259</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided GPU device&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-260"><a href="#MAMLHandler-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trainLoader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">=</span> <span class="n">trainDataLoader</span>
</span><span id="MAMLHandler-261"><a href="#MAMLHandler-261"><span class="linenos">261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided train dataloader&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-262"><a href="#MAMLHandler-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validationLoader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">=</span> <span class="n">validationDataLoader</span>
</span><span id="MAMLHandler-263"><a href="#MAMLHandler-263"><span class="linenos">263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided validation dataloader&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-264"><a href="#MAMLHandler-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopTrain</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">updateStepsInInnerLoopTrain</span>
</span><span id="MAMLHandler-265"><a href="#MAMLHandler-265"><span class="linenos">265</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of update steps provided for inner loop while training&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-266"><a href="#MAMLHandler-266"><span class="linenos">266</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">updateStepsInInnerLoopValid</span>
</span><span id="MAMLHandler-267"><a href="#MAMLHandler-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of update steps provided for inner loop while validation&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-268"><a href="#MAMLHandler-268"><span class="linenos">268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adaptLearningRate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">adaptLearningRate</span>
</span><span id="MAMLHandler-269"><a href="#MAMLHandler-269"><span class="linenos">269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided learning rate for inner loop&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-270"><a href="#MAMLHandler-270"><span class="linenos">270</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">epochs</span>
</span><span id="MAMLHandler-271"><a href="#MAMLHandler-271"><span class="linenos">271</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided number of epochs&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-272"><a href="#MAMLHandler-272"><span class="linenos">272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_optim</span><span class="p">:</span> <span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
</span><span id="MAMLHandler-273"><a href="#MAMLHandler-273"><span class="linenos">273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided torch optimizer&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-274"><a href="#MAMLHandler-274"><span class="linenos">274</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">modelName</span>
</span><span id="MAMLHandler-275"><a href="#MAMLHandler-275"><span class="linenos">275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided name of the model file&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-276"><a href="#MAMLHandler-276"><span class="linenos">276</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">modelSaveDir</span>
</span><span id="MAMLHandler-277"><a href="#MAMLHandler-277"><span class="linenos">277</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided path to directory to sabe the model&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-278"><a href="#MAMLHandler-278"><span class="linenos">278</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="p">:</span> <span class="n">Live</span> <span class="o">=</span> <span class="n">live</span>
</span><span id="MAMLHandler-279"><a href="#MAMLHandler-279"><span class="linenos">279</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided DVC live object&quot;&quot;&quot;</span>
</span><span id="MAMLHandler-280"><a href="#MAMLHandler-280"><span class="linenos">280</span></a>    
</span><span id="MAMLHandler-281"><a href="#MAMLHandler-281"><span class="linenos">281</span></a>    <span class="k">def</span> <span class="nf">__performAction</span><span class="p">(</span>
</span><span id="MAMLHandler-282"><a href="#MAMLHandler-282"><span class="linenos">282</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">actionType</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">X_support</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">y_support</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">X_query</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
</span><span id="MAMLHandler-283"><a href="#MAMLHandler-283"><span class="linenos">283</span></a>            <span class="n">y_query</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">adapt_steps</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MAMLHandler-284"><a href="#MAMLHandler-284"><span class="linenos">284</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
</span><span id="MAMLHandler-285"><a href="#MAMLHandler-285"><span class="linenos">285</span></a>
</span><span id="MAMLHandler-286"><a href="#MAMLHandler-286"><span class="linenos">286</span></a>        <span class="k">assert</span> <span class="n">actionType</span> <span class="ow">in</span> <span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">FINETUNE</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">]</span>
</span><span id="MAMLHandler-287"><a href="#MAMLHandler-287"><span class="linenos">287</span></a>        <span class="n">task_num</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="MAMLHandler-288"><a href="#MAMLHandler-288"><span class="linenos">288</span></a>        <span class="n">supportsz</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MAMLHandler-289"><a href="#MAMLHandler-289"><span class="linenos">289</span></a>        <span class="n">querysz</span> <span class="o">=</span> <span class="n">X_query</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MAMLHandler-290"><a href="#MAMLHandler-290"><span class="linenos">290</span></a>
</span><span id="MAMLHandler-291"><a href="#MAMLHandler-291"><span class="linenos">291</span></a>        <span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span>\
</span><span id="MAMLHandler-292"><a href="#MAMLHandler-292"><span class="linenos">292</span></a>            <span class="n">y_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">X_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">y_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler-293"><a href="#MAMLHandler-293"><span class="linenos">293</span></a>
</span><span id="MAMLHandler-294"><a href="#MAMLHandler-294"><span class="linenos">294</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
</span><span id="MAMLHandler-295"><a href="#MAMLHandler-295"><span class="linenos">295</span></a>        <span class="n">batch_norm_query</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MAMLHandler-296"><a href="#MAMLHandler-296"><span class="linenos">296</span></a>        <span class="k">if</span> <span class="n">actionType</span> <span class="ow">in</span> <span class="p">[</span><span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">constants</span><span class="o">.</span><span class="n">FINETUNE</span><span class="p">]:</span>
</span><span id="MAMLHandler-297"><a href="#MAMLHandler-297"><span class="linenos">297</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</span><span id="MAMLHandler-298"><a href="#MAMLHandler-298"><span class="linenos">298</span></a>            <span class="n">batch_norm_query</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MAMLHandler-299"><a href="#MAMLHandler-299"><span class="linenos">299</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler-300"><a href="#MAMLHandler-300"><span class="linenos">300</span></a>
</span><span id="MAMLHandler-301"><a href="#MAMLHandler-301"><span class="linenos">301</span></a>        <span class="c1">#losses_q[i] is the loss on step i</span>
</span><span id="MAMLHandler-302"><a href="#MAMLHandler-302"><span class="linenos">302</span></a>        <span class="n">losses_q</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">adapt_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> 
</span><span id="MAMLHandler-303"><a href="#MAMLHandler-303"><span class="linenos">303</span></a>        <span class="n">corrects</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">adapt_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="MAMLHandler-304"><a href="#MAMLHandler-304"><span class="linenos">304</span></a>        <span class="k">if</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span>
</span><span id="MAMLHandler-305"><a href="#MAMLHandler-305"><span class="linenos">305</span></a>            <span class="n">corrects_support</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">adapt_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>    
</span><span id="MAMLHandler-306"><a href="#MAMLHandler-306"><span class="linenos">306</span></a>
</span><span id="MAMLHandler-307"><a href="#MAMLHandler-307"><span class="linenos">307</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">task_num</span><span class="p">):</span>
</span><span id="MAMLHandler-308"><a href="#MAMLHandler-308"><span class="linenos">308</span></a>            <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_support</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">vars</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bn_training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MAMLHandler-309"><a href="#MAMLHandler-309"><span class="linenos">309</span></a>            <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y_support</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MAMLHandler-310"><a href="#MAMLHandler-310"><span class="linenos">310</span></a>            <span class="n">grad</span> <span class="o">=</span> <span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
</span><span id="MAMLHandler-311"><a href="#MAMLHandler-311"><span class="linenos">311</span></a>            <span class="n">fast_weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
</span><span id="MAMLHandler-312"><a href="#MAMLHandler-312"><span class="linenos">312</span></a>                <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptLearningRate</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
</span><span id="MAMLHandler-313"><a href="#MAMLHandler-313"><span class="linenos">313</span></a>            <span class="p">))</span>
</span><span id="MAMLHandler-314"><a href="#MAMLHandler-314"><span class="linenos">314</span></a>
</span><span id="MAMLHandler-315"><a href="#MAMLHandler-315"><span class="linenos">315</span></a>            <span class="c1"># this is the loss and accuracy before first update</span>
</span><span id="MAMLHandler-316"><a href="#MAMLHandler-316"><span class="linenos">316</span></a>            <span class="k">with</span> <span class="n">no_grad</span><span class="p">():</span>
</span><span id="MAMLHandler-317"><a href="#MAMLHandler-317"><span class="linenos">317</span></a>                <span class="c1"># [setsz, nway]</span>
</span><span id="MAMLHandler-318"><a href="#MAMLHandler-318"><span class="linenos">318</span></a>                <span class="k">if</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span>
</span><span id="MAMLHandler-319"><a href="#MAMLHandler-319"><span class="linenos">319</span></a>                    <span class="n">pred_support</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MAMLHandler-320"><a href="#MAMLHandler-320"><span class="linenos">320</span></a>                    <span class="n">corrects_support</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects_support</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="MAMLHandler-321"><a href="#MAMLHandler-321"><span class="linenos">321</span></a>                <span class="n">logits_q</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_query</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">bn_training</span><span class="o">=</span><span class="n">batch_norm_query</span><span class="p">)</span>
</span><span id="MAMLHandler-322"><a href="#MAMLHandler-322"><span class="linenos">322</span></a>                <span class="n">loss_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MAMLHandler-323"><a href="#MAMLHandler-323"><span class="linenos">323</span></a>                <span class="n">losses_q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss_q</span>
</span><span id="MAMLHandler-324"><a href="#MAMLHandler-324"><span class="linenos">324</span></a>
</span><span id="MAMLHandler-325"><a href="#MAMLHandler-325"><span class="linenos">325</span></a>                <span class="n">pred_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MAMLHandler-326"><a href="#MAMLHandler-326"><span class="linenos">326</span></a>                <span class="n">correct</span> <span class="o">=</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="MAMLHandler-327"><a href="#MAMLHandler-327"><span class="linenos">327</span></a>                <span class="n">corrects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">correct</span>
</span><span id="MAMLHandler-328"><a href="#MAMLHandler-328"><span class="linenos">328</span></a>
</span><span id="MAMLHandler-329"><a href="#MAMLHandler-329"><span class="linenos">329</span></a>            <span class="c1"># this is the loss and accuracy after the first update</span>
</span><span id="MAMLHandler-330"><a href="#MAMLHandler-330"><span class="linenos">330</span></a>            <span class="k">with</span> <span class="n">no_grad</span><span class="p">():</span>
</span><span id="MAMLHandler-331"><a href="#MAMLHandler-331"><span class="linenos">331</span></a>                <span class="c1"># [setsz, nway]</span>
</span><span id="MAMLHandler-332"><a href="#MAMLHandler-332"><span class="linenos">332</span></a>                <span class="k">if</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span>
</span><span id="MAMLHandler-333"><a href="#MAMLHandler-333"><span class="linenos">333</span></a>                    <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_support</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">vars</span><span class="o">=</span><span class="n">fast_weights</span><span class="p">,</span> <span class="n">bn_training</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MAMLHandler-334"><a href="#MAMLHandler-334"><span class="linenos">334</span></a>                    <span class="n">pred_support</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MAMLHandler-335"><a href="#MAMLHandler-335"><span class="linenos">335</span></a>                    <span class="n">corrects_support</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects_support</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="MAMLHandler-336"><a href="#MAMLHandler-336"><span class="linenos">336</span></a>                <span class="n">logits_q</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_query</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fast_weights</span><span class="p">,</span> <span class="n">bn_training</span><span class="o">=</span><span class="n">batch_norm_query</span><span class="p">)</span>
</span><span id="MAMLHandler-337"><a href="#MAMLHandler-337"><span class="linenos">337</span></a>                <span class="n">loss_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MAMLHandler-338"><a href="#MAMLHandler-338"><span class="linenos">338</span></a>                <span class="n">losses_q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss_q</span>
</span><span id="MAMLHandler-339"><a href="#MAMLHandler-339"><span class="linenos">339</span></a>                <span class="c1"># [setsz]</span>
</span><span id="MAMLHandler-340"><a href="#MAMLHandler-340"><span class="linenos">340</span></a>                <span class="n">pred_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MAMLHandler-341"><a href="#MAMLHandler-341"><span class="linenos">341</span></a>                <span class="n">correct</span> <span class="o">=</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="MAMLHandler-342"><a href="#MAMLHandler-342"><span class="linenos">342</span></a>                <span class="n">corrects</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">correct</span>
</span><span id="MAMLHandler-343"><a href="#MAMLHandler-343"><span class="linenos">343</span></a>
</span><span id="MAMLHandler-344"><a href="#MAMLHandler-344"><span class="linenos">344</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">adapt_steps</span><span class="p">):</span>
</span><span id="MAMLHandler-345"><a href="#MAMLHandler-345"><span class="linenos">345</span></a>                <span class="c1"># 1. run the i-th task and compute loss for k=1~K-1</span>
</span><span id="MAMLHandler-346"><a href="#MAMLHandler-346"><span class="linenos">346</span></a>                <span class="n">logits</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_support</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fast_weights</span><span class="p">,</span> <span class="n">bn_training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MAMLHandler-347"><a href="#MAMLHandler-347"><span class="linenos">347</span></a>                <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y_support</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MAMLHandler-348"><a href="#MAMLHandler-348"><span class="linenos">348</span></a>                <span class="c1"># 2. compute grad on theta_pi</span>
</span><span id="MAMLHandler-349"><a href="#MAMLHandler-349"><span class="linenos">349</span></a>                <span class="n">grad</span> <span class="o">=</span> <span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">fast_weights</span><span class="p">)</span>
</span><span id="MAMLHandler-350"><a href="#MAMLHandler-350"><span class="linenos">350</span></a>                <span class="c1"># 3. theta_pi = theta_pi - train_lr * grad</span>
</span><span id="MAMLHandler-351"><a href="#MAMLHandler-351"><span class="linenos">351</span></a>                <span class="n">fast_weights</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span>
</span><span id="MAMLHandler-352"><a href="#MAMLHandler-352"><span class="linenos">352</span></a>                    <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptLearningRate</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">zip</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="n">fast_weights</span><span class="p">)</span>
</span><span id="MAMLHandler-353"><a href="#MAMLHandler-353"><span class="linenos">353</span></a>                <span class="p">))</span>
</span><span id="MAMLHandler-354"><a href="#MAMLHandler-354"><span class="linenos">354</span></a>
</span><span id="MAMLHandler-355"><a href="#MAMLHandler-355"><span class="linenos">355</span></a>                <span class="n">logits_q</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_query</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fast_weights</span><span class="p">,</span> <span class="n">bn_training</span><span class="o">=</span><span class="n">batch_norm_query</span><span class="p">)</span>
</span><span id="MAMLHandler-356"><a href="#MAMLHandler-356"><span class="linenos">356</span></a>                <span class="c1"># loss_q will be overwritten and just keep the loss_q on last update step.</span>
</span><span id="MAMLHandler-357"><a href="#MAMLHandler-357"><span class="linenos">357</span></a>                <span class="n">loss_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">cross_entropy</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MAMLHandler-358"><a href="#MAMLHandler-358"><span class="linenos">358</span></a>                <span class="n">losses_q</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">loss_q</span>
</span><span id="MAMLHandler-359"><a href="#MAMLHandler-359"><span class="linenos">359</span></a>
</span><span id="MAMLHandler-360"><a href="#MAMLHandler-360"><span class="linenos">360</span></a>                <span class="k">with</span> <span class="n">no_grad</span><span class="p">():</span>
</span><span id="MAMLHandler-361"><a href="#MAMLHandler-361"><span class="linenos">361</span></a>                    <span class="k">if</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span>
</span><span id="MAMLHandler-362"><a href="#MAMLHandler-362"><span class="linenos">362</span></a>                        <span class="n">pred_support</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MAMLHandler-363"><a href="#MAMLHandler-363"><span class="linenos">363</span></a>                        <span class="n">corrects_support</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects_support</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="MAMLHandler-364"><a href="#MAMLHandler-364"><span class="linenos">364</span></a>                    <span class="n">pred_q</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits_q</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MAMLHandler-365"><a href="#MAMLHandler-365"><span class="linenos">365</span></a>                    <span class="n">correct</span> <span class="o">=</span> <span class="n">eq</span><span class="p">(</span><span class="n">pred_q</span><span class="p">,</span> <span class="n">y_query</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>  <span class="c1"># convert to numpy</span>
</span><span id="MAMLHandler-366"><a href="#MAMLHandler-366"><span class="linenos">366</span></a>                    <span class="n">corrects</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">corrects</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">correct</span>
</span><span id="MAMLHandler-367"><a href="#MAMLHandler-367"><span class="linenos">367</span></a>
</span><span id="MAMLHandler-368"><a href="#MAMLHandler-368"><span class="linenos">368</span></a>
</span><span id="MAMLHandler-369"><a href="#MAMLHandler-369"><span class="linenos">369</span></a>
</span><span id="MAMLHandler-370"><a href="#MAMLHandler-370"><span class="linenos">370</span></a>        <span class="c1"># end of all tasks</span>
</span><span id="MAMLHandler-371"><a href="#MAMLHandler-371"><span class="linenos">371</span></a>        <span class="c1"># sum over all losses on query set across all tasks</span>
</span><span id="MAMLHandler-372"><a href="#MAMLHandler-372"><span class="linenos">372</span></a>        <span class="n">loss_q</span> <span class="o">=</span> <span class="n">losses_q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">task_num</span>
</span><span id="MAMLHandler-373"><a href="#MAMLHandler-373"><span class="linenos">373</span></a>
</span><span id="MAMLHandler-374"><a href="#MAMLHandler-374"><span class="linenos">374</span></a>        <span class="c1"># optimize theta parameters</span>
</span><span id="MAMLHandler-375"><a href="#MAMLHandler-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="n">actionType</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span><span class="p">:</span>
</span><span id="MAMLHandler-376"><a href="#MAMLHandler-376"><span class="linenos">376</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_optim</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="MAMLHandler-377"><a href="#MAMLHandler-377"><span class="linenos">377</span></a>            <span class="n">loss_q</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="MAMLHandler-378"><a href="#MAMLHandler-378"><span class="linenos">378</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">meta_optim</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="MAMLHandler-379"><a href="#MAMLHandler-379"><span class="linenos">379</span></a>        <span class="n">accs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">corrects</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">querysz</span> <span class="o">*</span> <span class="n">task_num</span><span class="p">)</span>
</span><span id="MAMLHandler-380"><a href="#MAMLHandler-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="n">actionType</span> <span class="o">==</span> <span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">:</span>
</span><span id="MAMLHandler-381"><a href="#MAMLHandler-381"><span class="linenos">381</span></a>            <span class="k">del</span> <span class="n">model</span>
</span><span id="MAMLHandler-382"><a href="#MAMLHandler-382"><span class="linenos">382</span></a>            <span class="k">if</span> <span class="n">get_fine_tune_metrics</span><span class="p">:</span>
</span><span id="MAMLHandler-383"><a href="#MAMLHandler-383"><span class="linenos">383</span></a>                <span class="n">accs_support</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">corrects_support</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">supportsz</span> <span class="o">*</span> <span class="n">task_num</span><span class="p">)</span>
</span><span id="MAMLHandler-384"><a href="#MAMLHandler-384"><span class="linenos">384</span></a>                <span class="k">return</span> <span class="n">accs</span><span class="p">,</span> <span class="n">accs_support</span>
</span><span id="MAMLHandler-385"><a href="#MAMLHandler-385"><span class="linenos">385</span></a>            <span class="k">return</span> <span class="n">accs</span>
</span><span id="MAMLHandler-386"><a href="#MAMLHandler-386"><span class="linenos">386</span></a>        <span class="k">if</span> <span class="n">actionType</span> <span class="o">==</span> <span class="n">constants</span><span class="o">.</span><span class="n">FINETUNE</span><span class="p">:</span>
</span><span id="MAMLHandler-387"><a href="#MAMLHandler-387"><span class="linenos">387</span></a>            <span class="k">return</span>  <span class="n">model</span><span class="p">,</span><span class="n">accs</span>
</span><span id="MAMLHandler-388"><a href="#MAMLHandler-388"><span class="linenos">388</span></a>        <span class="k">return</span> <span class="n">accs</span>
</span><span id="MAMLHandler-389"><a href="#MAMLHandler-389"><span class="linenos">389</span></a>    
</span><span id="MAMLHandler-390"><a href="#MAMLHandler-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MAMLHandler-391"><a href="#MAMLHandler-391"><span class="linenos">391</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to start the MAML training</span>
</span><span id="MAMLHandler-392"><a href="#MAMLHandler-392"><span class="linenos">392</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="MAMLHandler-393"><a href="#MAMLHandler-393"><span class="linenos">393</span></a>        <span class="n">maxValidationAccSoFar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NINF</span>
</span><span id="MAMLHandler-394"><a href="#MAMLHandler-394"><span class="linenos">394</span></a>        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Epochs&#39;</span><span class="p">):</span>
</span><span id="MAMLHandler-395"><a href="#MAMLHandler-395"><span class="linenos">395</span></a>            <span class="n">acc_all_train</span> <span class="o">=</span> <span class="p">[]</span> 
</span><span id="MAMLHandler-396"><a href="#MAMLHandler-396"><span class="linenos">396</span></a>            <span class="k">for</span> <span class="n">metaStep</span><span class="p">,</span> <span class="p">(</span><span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainLoader</span><span class="p">):</span>
</span><span id="MAMLHandler-397"><a href="#MAMLHandler-397"><span class="linenos">397</span></a>                <span class="n">X_support</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler-398"><a href="#MAMLHandler-398"><span class="linenos">398</span></a>                <span class="n">y_support</span> <span class="o">=</span> <span class="n">y_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler-399"><a href="#MAMLHandler-399"><span class="linenos">399</span></a>                <span class="n">X_query</span> <span class="o">=</span> <span class="n">X_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler-400"><a href="#MAMLHandler-400"><span class="linenos">400</span></a>                <span class="n">y_query</span> <span class="o">=</span> <span class="n">y_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler-401"><a href="#MAMLHandler-401"><span class="linenos">401</span></a>
</span><span id="MAMLHandler-402"><a href="#MAMLHandler-402"><span class="linenos">402</span></a>                <span class="c1">## performe a meta update</span>
</span><span id="MAMLHandler-403"><a href="#MAMLHandler-403"><span class="linenos">403</span></a>                <span class="n">trainAcc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span>
</span><span id="MAMLHandler-404"><a href="#MAMLHandler-404"><span class="linenos">404</span></a>                    <span class="n">constants</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">,</span> <span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopTrain</span>
</span><span id="MAMLHandler-405"><a href="#MAMLHandler-405"><span class="linenos">405</span></a>                <span class="p">)</span>
</span><span id="MAMLHandler-406"><a href="#MAMLHandler-406"><span class="linenos">406</span></a>                <span class="n">acc_all_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trainAcc</span><span class="p">)</span>
</span><span id="MAMLHandler-407"><a href="#MAMLHandler-407"><span class="linenos">407</span></a>                <span class="k">if</span> <span class="n">metaStep</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MAMLHandler-408"><a href="#MAMLHandler-408"><span class="linenos">408</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;step:&#39;</span><span class="p">,</span> <span class="n">metaStep</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">training acc:&#39;</span><span class="p">,</span> <span class="n">trainAcc</span><span class="p">)</span>
</span><span id="MAMLHandler-409"><a href="#MAMLHandler-409"><span class="linenos">409</span></a>
</span><span id="MAMLHandler-410"><a href="#MAMLHandler-410"><span class="linenos">410</span></a>                <span class="k">if</span> <span class="n">metaStep</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># evaluation or validation</span>
</span><span id="MAMLHandler-411"><a href="#MAMLHandler-411"><span class="linenos">411</span></a>                    <span class="n">accs_all_validation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MAMLHandler-412"><a href="#MAMLHandler-412"><span class="linenos">412</span></a>                    <span class="k">for</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validationLoader</span><span class="p">:</span>
</span><span id="MAMLHandler-413"><a href="#MAMLHandler-413"><span class="linenos">413</span></a>                        <span class="n">accs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span><span class="p">)</span>
</span><span id="MAMLHandler-414"><a href="#MAMLHandler-414"><span class="linenos">414</span></a>                        <span class="n">accs_all_validation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accs</span><span class="p">)</span>
</span><span id="MAMLHandler-415"><a href="#MAMLHandler-415"><span class="linenos">415</span></a>
</span><span id="MAMLHandler-416"><a href="#MAMLHandler-416"><span class="linenos">416</span></a>                    <span class="n">accs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">accs_all_validation</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
</span><span id="MAMLHandler-417"><a href="#MAMLHandler-417"><span class="linenos">417</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Validation acc:&#39;</span><span class="p">,</span> <span class="n">accs</span><span class="p">)</span>
</span><span id="MAMLHandler-418"><a href="#MAMLHandler-418"><span class="linenos">418</span></a>            <span class="n">accs_all_validation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MAMLHandler-419"><a href="#MAMLHandler-419"><span class="linenos">419</span></a>            <span class="k">for</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validationLoader</span><span class="p">:</span>
</span><span id="MAMLHandler-420"><a href="#MAMLHandler-420"><span class="linenos">420</span></a>                <span class="n">accs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span><span class="p">)</span>
</span><span id="MAMLHandler-421"><a href="#MAMLHandler-421"><span class="linenos">421</span></a>                <span class="n">accs_all_validation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accs</span><span class="p">)</span>
</span><span id="MAMLHandler-422"><a href="#MAMLHandler-422"><span class="linenos">422</span></a>            <span class="n">acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_all_train</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLHandler-423"><a href="#MAMLHandler-423"><span class="linenos">423</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;training_acc_vs_epoch&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
</span><span id="MAMLHandler-424"><a href="#MAMLHandler-424"><span class="linenos">424</span></a>            <span class="n">acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">accs_all_validation</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLHandler-425"><a href="#MAMLHandler-425"><span class="linenos">425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;validation_acc_vs_epoch&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
</span><span id="MAMLHandler-426"><a href="#MAMLHandler-426"><span class="linenos">426</span></a>            <span class="k">if</span> <span class="n">acc</span> <span class="o">&gt;</span> <span class="n">maxValidationAccSoFar</span><span class="p">:</span>
</span><span id="MAMLHandler-427"><a href="#MAMLHandler-427"><span class="linenos">427</span></a>                <span class="n">maxValidationAccSoFar</span> <span class="o">=</span> <span class="n">acc</span>
</span><span id="MAMLHandler-428"><a href="#MAMLHandler-428"><span class="linenos">428</span></a>                <span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span> <span class="o">+</span> <span class="s2">&quot;.pt&quot;</span><span class="p">))</span>
</span><span id="MAMLHandler-429"><a href="#MAMLHandler-429"><span class="linenos">429</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current Validation Accuracy: </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MAMLHandler-430"><a href="#MAMLHandler-430"><span class="linenos">430</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max Validation Accuracy so far: </span><span class="si">{</span><span class="n">maxValidationAccSoFar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MAMLHandler-431"><a href="#MAMLHandler-431"><span class="linenos">431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">next_step</span><span class="p">()</span>
</span><span id="MAMLHandler-432"><a href="#MAMLHandler-432"><span class="linenos">432</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span> <span class="o">+</span> <span class="s2">&quot;.pt&quot;</span><span class="p">),</span> <span class="n">map_location</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="MAMLHandler-433"><a href="#MAMLHandler-433"><span class="linenos">433</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;best_validation_acc&quot;</span><span class="p">,</span> <span class="n">maxValidationAccSoFar</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="MAMLHandler-434"><a href="#MAMLHandler-434"><span class="linenos">434</span></a>    
</span><span id="MAMLHandler-435"><a href="#MAMLHandler-435"><span class="linenos">435</span></a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_data</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">adapt_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MAMLHandler-436"><a href="#MAMLHandler-436"><span class="linenos">436</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check performance on test data</span>
</span><span id="MAMLHandler-437"><a href="#MAMLHandler-437"><span class="linenos">437</span></a>
</span><span id="MAMLHandler-438"><a href="#MAMLHandler-438"><span class="linenos">438</span></a><span class="sd">        Parameters</span>
</span><span id="MAMLHandler-439"><a href="#MAMLHandler-439"><span class="linenos">439</span></a><span class="sd">        ----------</span>
</span><span id="MAMLHandler-440"><a href="#MAMLHandler-440"><span class="linenos">440</span></a><span class="sd">        test_data : DataLoader</span>
</span><span id="MAMLHandler-441"><a href="#MAMLHandler-441"><span class="linenos">441</span></a><span class="sd">            The test data</span>
</span><span id="MAMLHandler-442"><a href="#MAMLHandler-442"><span class="linenos">442</span></a><span class="sd">        adapt_steps : int, optional</span>
</span><span id="MAMLHandler-443"><a href="#MAMLHandler-443"><span class="linenos">443</span></a><span class="sd">            Number of steps for adaptation. If None then same as that in validation, by default None</span>
</span><span id="MAMLHandler-444"><a href="#MAMLHandler-444"><span class="linenos">444</span></a>
</span><span id="MAMLHandler-445"><a href="#MAMLHandler-445"><span class="linenos">445</span></a><span class="sd">        Returns</span>
</span><span id="MAMLHandler-446"><a href="#MAMLHandler-446"><span class="linenos">446</span></a><span class="sd">        -------</span>
</span><span id="MAMLHandler-447"><a href="#MAMLHandler-447"><span class="linenos">447</span></a><span class="sd">        tuple</span>
</span><span id="MAMLHandler-448"><a href="#MAMLHandler-448"><span class="linenos">448</span></a><span class="sd">            Tuple containing test accuracies and training accuracies during finetuning at  each</span>
</span><span id="MAMLHandler-449"><a href="#MAMLHandler-449"><span class="linenos">449</span></a><span class="sd">            iteration. Both the elements of the tuple is a list. Also the accuracies are avreaged</span>
</span><span id="MAMLHandler-450"><a href="#MAMLHandler-450"><span class="linenos">450</span></a><span class="sd">            over all the provided subjects.</span>
</span><span id="MAMLHandler-451"><a href="#MAMLHandler-451"><span class="linenos">451</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MAMLHandler-452"><a href="#MAMLHandler-452"><span class="linenos">452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span> <span class="o">+</span> <span class="s2">&quot;.pt&quot;</span><span class="p">),</span> <span class="n">map_location</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="MAMLHandler-453"><a href="#MAMLHandler-453"><span class="linenos">453</span></a>        <span class="n">adapt_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span> <span class="k">if</span> <span class="n">adapt_steps</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">adapt_steps</span>
</span><span id="MAMLHandler-454"><a href="#MAMLHandler-454"><span class="linenos">454</span></a>        <span class="n">acc_all_finetune</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MAMLHandler-455"><a href="#MAMLHandler-455"><span class="linenos">455</span></a>        <span class="n">acc_all_test</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MAMLHandler-456"><a href="#MAMLHandler-456"><span class="linenos">456</span></a>        <span class="k">for</span> <span class="n">metaStep</span><span class="p">,</span> <span class="p">(</span><span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_data</span><span class="p">):</span>
</span><span id="MAMLHandler-457"><a href="#MAMLHandler-457"><span class="linenos">457</span></a>                <span class="n">X_support</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler-458"><a href="#MAMLHandler-458"><span class="linenos">458</span></a>                <span class="n">y_support</span> <span class="o">=</span> <span class="n">y_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler-459"><a href="#MAMLHandler-459"><span class="linenos">459</span></a>                <span class="n">X_query</span> <span class="o">=</span> <span class="n">X_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler-460"><a href="#MAMLHandler-460"><span class="linenos">460</span></a>                <span class="n">y_query</span> <span class="o">=</span> <span class="n">y_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler-461"><a href="#MAMLHandler-461"><span class="linenos">461</span></a>
</span><span id="MAMLHandler-462"><a href="#MAMLHandler-462"><span class="linenos">462</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span>
</span><span id="MAMLHandler-463"><a href="#MAMLHandler-463"><span class="linenos">463</span></a>                    <span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">,</span> <span class="n">adapt_steps</span><span class="p">,</span> <span class="kc">True</span>
</span><span id="MAMLHandler-464"><a href="#MAMLHandler-464"><span class="linenos">464</span></a>                <span class="p">)</span>
</span><span id="MAMLHandler-465"><a href="#MAMLHandler-465"><span class="linenos">465</span></a>                <span class="n">acc_all_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLHandler-466"><a href="#MAMLHandler-466"><span class="linenos">466</span></a>                <span class="n">acc_all_finetune</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="MAMLHandler-467"><a href="#MAMLHandler-467"><span class="linenos">467</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_all_test</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_all_finetune</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Wrapper class to train a model using Meta Agnostic Meta Learning</p>
</div>


                            <div id="MAMLHandler.__init__" class="classattr">
                                        <input id="MAMLHandler.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MAMLHandler</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">model</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span>,</span><span class="param">	<span class="n">device</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">trainDataLoader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dataloader</span><span class="o">.</span><span class="n">DataLoader</span>,</span><span class="param">	<span class="n">validationDataLoader</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dataloader</span><span class="o">.</span><span class="n">DataLoader</span>,</span><span class="param">	<span class="n">updateStepsInInnerLoopTrain</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">updateStepsInInnerLoopValid</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">adaptLearningRate</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">optimizer</span>,</span><span class="param">	<span class="n">live</span><span class="p">:</span> <span class="n">dvclive</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">Live</span>,</span><span class="param">	<span class="n">modelSaveDir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">modelName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="MAMLHandler.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MAMLHandler.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MAMLHandler.__init__-220"><a href="#MAMLHandler.__init__-220"><span class="linenos">220</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="MAMLHandler.__init__-221"><a href="#MAMLHandler.__init__-221"><span class="linenos">221</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Module</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">trainDataLoader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span>
</span><span id="MAMLHandler.__init__-222"><a href="#MAMLHandler.__init__-222"><span class="linenos">222</span></a>            <span class="n">validationDataLoader</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">updateStepsInInnerLoopTrain</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MAMLHandler.__init__-223"><a href="#MAMLHandler.__init__-223"><span class="linenos">223</span></a>            <span class="n">updateStepsInInnerLoopValid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">adaptLearningRate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MAMLHandler.__init__-224"><a href="#MAMLHandler.__init__-224"><span class="linenos">224</span></a>            <span class="n">optimizer</span><span class="p">,</span> <span class="n">live</span><span class="p">:</span> <span class="n">Live</span><span class="p">,</span> <span class="n">modelSaveDir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">modelName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MAMLHandler.__init__-225"><a href="#MAMLHandler.__init__-225"><span class="linenos">225</span></a>    <span class="p">):</span>
</span><span id="MAMLHandler.__init__-226"><a href="#MAMLHandler.__init__-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-227"><a href="#MAMLHandler.__init__-227"><span class="linenos">227</span></a><span class="sd">        Creating an object of MAMLHandler class.</span>
</span><span id="MAMLHandler.__init__-228"><a href="#MAMLHandler.__init__-228"><span class="linenos">228</span></a>
</span><span id="MAMLHandler.__init__-229"><a href="#MAMLHandler.__init__-229"><span class="linenos">229</span></a><span class="sd">        Parameters</span>
</span><span id="MAMLHandler.__init__-230"><a href="#MAMLHandler.__init__-230"><span class="linenos">230</span></a><span class="sd">        ----------</span>
</span><span id="MAMLHandler.__init__-231"><a href="#MAMLHandler.__init__-231"><span class="linenos">231</span></a><span class="sd">        model : Module</span>
</span><span id="MAMLHandler.__init__-232"><a href="#MAMLHandler.__init__-232"><span class="linenos">232</span></a><span class="sd">            Model to be trained</span>
</span><span id="MAMLHandler.__init__-233"><a href="#MAMLHandler.__init__-233"><span class="linenos">233</span></a><span class="sd">        device : int</span>
</span><span id="MAMLHandler.__init__-234"><a href="#MAMLHandler.__init__-234"><span class="linenos">234</span></a><span class="sd">            device id</span>
</span><span id="MAMLHandler.__init__-235"><a href="#MAMLHandler.__init__-235"><span class="linenos">235</span></a><span class="sd">        trainDataLoader : DataLoader</span>
</span><span id="MAMLHandler.__init__-236"><a href="#MAMLHandler.__init__-236"><span class="linenos">236</span></a><span class="sd">            train data loader</span>
</span><span id="MAMLHandler.__init__-237"><a href="#MAMLHandler.__init__-237"><span class="linenos">237</span></a><span class="sd">        validationDataLoader : DataLoader</span>
</span><span id="MAMLHandler.__init__-238"><a href="#MAMLHandler.__init__-238"><span class="linenos">238</span></a><span class="sd">            validation data loader</span>
</span><span id="MAMLHandler.__init__-239"><a href="#MAMLHandler.__init__-239"><span class="linenos">239</span></a><span class="sd">        updateStepsInInnerLoopTrain : int</span>
</span><span id="MAMLHandler.__init__-240"><a href="#MAMLHandler.__init__-240"><span class="linenos">240</span></a><span class="sd">            number of gradient update steps while training</span>
</span><span id="MAMLHandler.__init__-241"><a href="#MAMLHandler.__init__-241"><span class="linenos">241</span></a><span class="sd">        updateStepsInInnerLoopTest : int</span>
</span><span id="MAMLHandler.__init__-242"><a href="#MAMLHandler.__init__-242"><span class="linenos">242</span></a><span class="sd">            number of gradient update steps while validation</span>
</span><span id="MAMLHandler.__init__-243"><a href="#MAMLHandler.__init__-243"><span class="linenos">243</span></a><span class="sd">        adaptLearningRate : float</span>
</span><span id="MAMLHandler.__init__-244"><a href="#MAMLHandler.__init__-244"><span class="linenos">244</span></a><span class="sd">            learning while adapting (inner loop)</span>
</span><span id="MAMLHandler.__init__-245"><a href="#MAMLHandler.__init__-245"><span class="linenos">245</span></a><span class="sd">        epochs : int</span>
</span><span id="MAMLHandler.__init__-246"><a href="#MAMLHandler.__init__-246"><span class="linenos">246</span></a><span class="sd">            number of epochs</span>
</span><span id="MAMLHandler.__init__-247"><a href="#MAMLHandler.__init__-247"><span class="linenos">247</span></a><span class="sd">        optimizer : torch.optim.Optimizer</span>
</span><span id="MAMLHandler.__init__-248"><a href="#MAMLHandler.__init__-248"><span class="linenos">248</span></a><span class="sd">            Optimizer to be used</span>
</span><span id="MAMLHandler.__init__-249"><a href="#MAMLHandler.__init__-249"><span class="linenos">249</span></a><span class="sd">        live : dvclive.Live</span>
</span><span id="MAMLHandler.__init__-250"><a href="#MAMLHandler.__init__-250"><span class="linenos">250</span></a><span class="sd">            A DVC live object for logging</span>
</span><span id="MAMLHandler.__init__-251"><a href="#MAMLHandler.__init__-251"><span class="linenos">251</span></a><span class="sd">        modelSaveDir : str, optional</span>
</span><span id="MAMLHandler.__init__-252"><a href="#MAMLHandler.__init__-252"><span class="linenos">252</span></a><span class="sd">            dir path to stoe model, by default None</span>
</span><span id="MAMLHandler.__init__-253"><a href="#MAMLHandler.__init__-253"><span class="linenos">253</span></a><span class="sd">        modelName : str, optional</span>
</span><span id="MAMLHandler.__init__-254"><a href="#MAMLHandler.__init__-254"><span class="linenos">254</span></a><span class="sd">            Name of model when saved</span>
</span><span id="MAMLHandler.__init__-255"><a href="#MAMLHandler.__init__-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>             
</span><span id="MAMLHandler.__init__-256"><a href="#MAMLHandler.__init__-256"><span class="linenos">256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span> <span class="n">Module</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="MAMLHandler.__init__-257"><a href="#MAMLHandler.__init__-257"><span class="linenos">257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided model during object creation&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-258"><a href="#MAMLHandler.__init__-258"><span class="linenos">258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="MAMLHandler.__init__-259"><a href="#MAMLHandler.__init__-259"><span class="linenos">259</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided GPU device&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-260"><a href="#MAMLHandler.__init__-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">trainLoader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">=</span> <span class="n">trainDataLoader</span>
</span><span id="MAMLHandler.__init__-261"><a href="#MAMLHandler.__init__-261"><span class="linenos">261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided train dataloader&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-262"><a href="#MAMLHandler.__init__-262"><span class="linenos">262</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validationLoader</span><span class="p">:</span> <span class="n">DataLoader</span> <span class="o">=</span> <span class="n">validationDataLoader</span>
</span><span id="MAMLHandler.__init__-263"><a href="#MAMLHandler.__init__-263"><span class="linenos">263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided validation dataloader&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-264"><a href="#MAMLHandler.__init__-264"><span class="linenos">264</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopTrain</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">updateStepsInInnerLoopTrain</span>
</span><span id="MAMLHandler.__init__-265"><a href="#MAMLHandler.__init__-265"><span class="linenos">265</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of update steps provided for inner loop while training&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-266"><a href="#MAMLHandler.__init__-266"><span class="linenos">266</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">updateStepsInInnerLoopValid</span>
</span><span id="MAMLHandler.__init__-267"><a href="#MAMLHandler.__init__-267"><span class="linenos">267</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of update steps provided for inner loop while validation&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-268"><a href="#MAMLHandler.__init__-268"><span class="linenos">268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">adaptLearningRate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">adaptLearningRate</span>
</span><span id="MAMLHandler.__init__-269"><a href="#MAMLHandler.__init__-269"><span class="linenos">269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided learning rate for inner loop&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-270"><a href="#MAMLHandler.__init__-270"><span class="linenos">270</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">epochs</span>
</span><span id="MAMLHandler.__init__-271"><a href="#MAMLHandler.__init__-271"><span class="linenos">271</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided number of epochs&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-272"><a href="#MAMLHandler.__init__-272"><span class="linenos">272</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta_optim</span><span class="p">:</span> <span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span> <span class="o">=</span> <span class="n">optimizer</span>
</span><span id="MAMLHandler.__init__-273"><a href="#MAMLHandler.__init__-273"><span class="linenos">273</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided torch optimizer&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-274"><a href="#MAMLHandler.__init__-274"><span class="linenos">274</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">modelName</span>
</span><span id="MAMLHandler.__init__-275"><a href="#MAMLHandler.__init__-275"><span class="linenos">275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided name of the model file&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-276"><a href="#MAMLHandler.__init__-276"><span class="linenos">276</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">modelSaveDir</span>
</span><span id="MAMLHandler.__init__-277"><a href="#MAMLHandler.__init__-277"><span class="linenos">277</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided path to directory to sabe the model&quot;&quot;&quot;</span>
</span><span id="MAMLHandler.__init__-278"><a href="#MAMLHandler.__init__-278"><span class="linenos">278</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="p">:</span> <span class="n">Live</span> <span class="o">=</span> <span class="n">live</span>
</span><span id="MAMLHandler.__init__-279"><a href="#MAMLHandler.__init__-279"><span class="linenos">279</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Provided DVC live object&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Creating an object of MAMLHandler class.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>model</strong> (Module):
Model to be trained</li>
<li><strong>device</strong> (int):
device id</li>
<li><strong>trainDataLoader</strong> (DataLoader):
train data loader</li>
<li><strong>validationDataLoader</strong> (DataLoader):
validation data loader</li>
<li><strong>updateStepsInInnerLoopTrain</strong> (int):
number of gradient update steps while training</li>
<li><strong>updateStepsInInnerLoopTest</strong> (int):
number of gradient update steps while validation</li>
<li><strong>adaptLearningRate</strong> (float):
learning while adapting (inner loop)</li>
<li><strong>epochs</strong> (int):
number of epochs</li>
<li><strong>optimizer</strong> (torch.optim.Optimizer):
Optimizer to be used</li>
<li><strong>live</strong> (dvclive.Live):
A DVC live object for logging</li>
<li><strong>modelSaveDir</strong> (str, optional):
dir path to stoe model, by default None</li>
<li><strong>modelName</strong> (str, optional):
Name of model when saved</li>
</ul>
</div>


                            </div>
                            <div id="MAMLHandler.model" class="classattr">
                                <div class="attr variable">
            <span class="name">model</span><span class="annotation">: torch.nn.modules.module.Module</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.model"></a>
    
            <div class="docstring"><p>Provided model during object creation</p>
</div>


                            </div>
                            <div id="MAMLHandler.device" class="classattr">
                                <div class="attr variable">
            <span class="name">device</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.device"></a>
    
            <div class="docstring"><p>Provided GPU device</p>
</div>


                            </div>
                            <div id="MAMLHandler.trainLoader" class="classattr">
                                <div class="attr variable">
            <span class="name">trainLoader</span><span class="annotation">: torch.utils.data.dataloader.DataLoader</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.trainLoader"></a>
    
            <div class="docstring"><p>Provided train dataloader</p>
</div>


                            </div>
                            <div id="MAMLHandler.validationLoader" class="classattr">
                                <div class="attr variable">
            <span class="name">validationLoader</span><span class="annotation">: torch.utils.data.dataloader.DataLoader</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.validationLoader"></a>
    
            <div class="docstring"><p>Provided validation dataloader</p>
</div>


                            </div>
                            <div id="MAMLHandler.stepsInInnerLoopTrain" class="classattr">
                                <div class="attr variable">
            <span class="name">stepsInInnerLoopTrain</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.stepsInInnerLoopTrain"></a>
    
            <div class="docstring"><p>Number of update steps provided for inner loop while training</p>
</div>


                            </div>
                            <div id="MAMLHandler.stepsInInnerLoopValid" class="classattr">
                                <div class="attr variable">
            <span class="name">stepsInInnerLoopValid</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.stepsInInnerLoopValid"></a>
    
            <div class="docstring"><p>Number of update steps provided for inner loop while validation</p>
</div>


                            </div>
                            <div id="MAMLHandler.adaptLearningRate" class="classattr">
                                <div class="attr variable">
            <span class="name">adaptLearningRate</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.adaptLearningRate"></a>
    
            <div class="docstring"><p>Provided learning rate for inner loop</p>
</div>


                            </div>
                            <div id="MAMLHandler.epochs" class="classattr">
                                <div class="attr variable">
            <span class="name">epochs</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.epochs"></a>
    
            <div class="docstring"><p>Provided number of epochs</p>
</div>


                            </div>
                            <div id="MAMLHandler.meta_optim" class="classattr">
                                <div class="attr variable">
            <span class="name">meta_optim</span><span class="annotation">: torch.optim.optimizer.Optimizer</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.meta_optim"></a>
    
            <div class="docstring"><p>Provided torch optimizer</p>
</div>


                            </div>
                            <div id="MAMLHandler.modelName" class="classattr">
                                <div class="attr variable">
            <span class="name">modelName</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.modelName"></a>
    
            <div class="docstring"><p>Provided name of the model file</p>
</div>


                            </div>
                            <div id="MAMLHandler.modelSaveDir" class="classattr">
                                <div class="attr variable">
            <span class="name">modelSaveDir</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.modelSaveDir"></a>
    
            <div class="docstring"><p>Provided path to directory to sabe the model</p>
</div>


                            </div>
                            <div id="MAMLHandler.live" class="classattr">
                                <div class="attr variable">
            <span class="name">live</span><span class="annotation">: dvclive.live.Live</span>

        
    </div>
    <a class="headerlink" href="#MAMLHandler.live"></a>
    
            <div class="docstring"><p>Provided DVC live object</p>
</div>


                            </div>
                            <div id="MAMLHandler.train" class="classattr">
                                        <input id="MAMLHandler.train-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">train</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MAMLHandler.train-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MAMLHandler.train"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MAMLHandler.train-390"><a href="#MAMLHandler.train-390"><span class="linenos">390</span></a>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MAMLHandler.train-391"><a href="#MAMLHandler.train-391"><span class="linenos">391</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Method to start the MAML training</span>
</span><span id="MAMLHandler.train-392"><a href="#MAMLHandler.train-392"><span class="linenos">392</span></a><span class="sd">        &quot;&quot;&quot;</span>        
</span><span id="MAMLHandler.train-393"><a href="#MAMLHandler.train-393"><span class="linenos">393</span></a>        <span class="n">maxValidationAccSoFar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NINF</span>
</span><span id="MAMLHandler.train-394"><a href="#MAMLHandler.train-394"><span class="linenos">394</span></a>        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epochs</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Epochs&#39;</span><span class="p">):</span>
</span><span id="MAMLHandler.train-395"><a href="#MAMLHandler.train-395"><span class="linenos">395</span></a>            <span class="n">acc_all_train</span> <span class="o">=</span> <span class="p">[]</span> 
</span><span id="MAMLHandler.train-396"><a href="#MAMLHandler.train-396"><span class="linenos">396</span></a>            <span class="k">for</span> <span class="n">metaStep</span><span class="p">,</span> <span class="p">(</span><span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainLoader</span><span class="p">):</span>
</span><span id="MAMLHandler.train-397"><a href="#MAMLHandler.train-397"><span class="linenos">397</span></a>                <span class="n">X_support</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler.train-398"><a href="#MAMLHandler.train-398"><span class="linenos">398</span></a>                <span class="n">y_support</span> <span class="o">=</span> <span class="n">y_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler.train-399"><a href="#MAMLHandler.train-399"><span class="linenos">399</span></a>                <span class="n">X_query</span> <span class="o">=</span> <span class="n">X_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler.train-400"><a href="#MAMLHandler.train-400"><span class="linenos">400</span></a>                <span class="n">y_query</span> <span class="o">=</span> <span class="n">y_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler.train-401"><a href="#MAMLHandler.train-401"><span class="linenos">401</span></a>
</span><span id="MAMLHandler.train-402"><a href="#MAMLHandler.train-402"><span class="linenos">402</span></a>                <span class="c1">## performe a meta update</span>
</span><span id="MAMLHandler.train-403"><a href="#MAMLHandler.train-403"><span class="linenos">403</span></a>                <span class="n">trainAcc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span>
</span><span id="MAMLHandler.train-404"><a href="#MAMLHandler.train-404"><span class="linenos">404</span></a>                    <span class="n">constants</span><span class="o">.</span><span class="n">TRAIN</span><span class="p">,</span> <span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopTrain</span>
</span><span id="MAMLHandler.train-405"><a href="#MAMLHandler.train-405"><span class="linenos">405</span></a>                <span class="p">)</span>
</span><span id="MAMLHandler.train-406"><a href="#MAMLHandler.train-406"><span class="linenos">406</span></a>                <span class="n">acc_all_train</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trainAcc</span><span class="p">)</span>
</span><span id="MAMLHandler.train-407"><a href="#MAMLHandler.train-407"><span class="linenos">407</span></a>                <span class="k">if</span> <span class="n">metaStep</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MAMLHandler.train-408"><a href="#MAMLHandler.train-408"><span class="linenos">408</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;step:&#39;</span><span class="p">,</span> <span class="n">metaStep</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">training acc:&#39;</span><span class="p">,</span> <span class="n">trainAcc</span><span class="p">)</span>
</span><span id="MAMLHandler.train-409"><a href="#MAMLHandler.train-409"><span class="linenos">409</span></a>
</span><span id="MAMLHandler.train-410"><a href="#MAMLHandler.train-410"><span class="linenos">410</span></a>                <span class="k">if</span> <span class="n">metaStep</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># evaluation or validation</span>
</span><span id="MAMLHandler.train-411"><a href="#MAMLHandler.train-411"><span class="linenos">411</span></a>                    <span class="n">accs_all_validation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MAMLHandler.train-412"><a href="#MAMLHandler.train-412"><span class="linenos">412</span></a>                    <span class="k">for</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validationLoader</span><span class="p">:</span>
</span><span id="MAMLHandler.train-413"><a href="#MAMLHandler.train-413"><span class="linenos">413</span></a>                        <span class="n">accs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span><span class="p">)</span>
</span><span id="MAMLHandler.train-414"><a href="#MAMLHandler.train-414"><span class="linenos">414</span></a>                        <span class="n">accs_all_validation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accs</span><span class="p">)</span>
</span><span id="MAMLHandler.train-415"><a href="#MAMLHandler.train-415"><span class="linenos">415</span></a>
</span><span id="MAMLHandler.train-416"><a href="#MAMLHandler.train-416"><span class="linenos">416</span></a>                    <span class="n">accs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">accs_all_validation</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
</span><span id="MAMLHandler.train-417"><a href="#MAMLHandler.train-417"><span class="linenos">417</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Validation acc:&#39;</span><span class="p">,</span> <span class="n">accs</span><span class="p">)</span>
</span><span id="MAMLHandler.train-418"><a href="#MAMLHandler.train-418"><span class="linenos">418</span></a>            <span class="n">accs_all_validation</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MAMLHandler.train-419"><a href="#MAMLHandler.train-419"><span class="linenos">419</span></a>            <span class="k">for</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validationLoader</span><span class="p">:</span>
</span><span id="MAMLHandler.train-420"><a href="#MAMLHandler.train-420"><span class="linenos">420</span></a>                <span class="n">accs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">x_spt</span><span class="p">,</span> <span class="n">y_spt</span><span class="p">,</span> <span class="n">x_qry</span><span class="p">,</span> <span class="n">y_qry</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span><span class="p">)</span>
</span><span id="MAMLHandler.train-421"><a href="#MAMLHandler.train-421"><span class="linenos">421</span></a>                <span class="n">accs_all_validation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">accs</span><span class="p">)</span>
</span><span id="MAMLHandler.train-422"><a href="#MAMLHandler.train-422"><span class="linenos">422</span></a>            <span class="n">acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_all_train</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLHandler.train-423"><a href="#MAMLHandler.train-423"><span class="linenos">423</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;training_acc_vs_epoch&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
</span><span id="MAMLHandler.train-424"><a href="#MAMLHandler.train-424"><span class="linenos">424</span></a>            <span class="n">acc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">accs_all_validation</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MAMLHandler.train-425"><a href="#MAMLHandler.train-425"><span class="linenos">425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;validation_acc_vs_epoch&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
</span><span id="MAMLHandler.train-426"><a href="#MAMLHandler.train-426"><span class="linenos">426</span></a>            <span class="k">if</span> <span class="n">acc</span> <span class="o">&gt;</span> <span class="n">maxValidationAccSoFar</span><span class="p">:</span>
</span><span id="MAMLHandler.train-427"><a href="#MAMLHandler.train-427"><span class="linenos">427</span></a>                <span class="n">maxValidationAccSoFar</span> <span class="o">=</span> <span class="n">acc</span>
</span><span id="MAMLHandler.train-428"><a href="#MAMLHandler.train-428"><span class="linenos">428</span></a>                <span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span> <span class="o">+</span> <span class="s2">&quot;.pt&quot;</span><span class="p">))</span>
</span><span id="MAMLHandler.train-429"><a href="#MAMLHandler.train-429"><span class="linenos">429</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current Validation Accuracy: </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MAMLHandler.train-430"><a href="#MAMLHandler.train-430"><span class="linenos">430</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max Validation Accuracy so far: </span><span class="si">{</span><span class="n">maxValidationAccSoFar</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MAMLHandler.train-431"><a href="#MAMLHandler.train-431"><span class="linenos">431</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">next_step</span><span class="p">()</span>
</span><span id="MAMLHandler.train-432"><a href="#MAMLHandler.train-432"><span class="linenos">432</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span> <span class="o">+</span> <span class="s2">&quot;.pt&quot;</span><span class="p">),</span> <span class="n">map_location</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="MAMLHandler.train-433"><a href="#MAMLHandler.train-433"><span class="linenos">433</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">live</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;best_validation_acc&quot;</span><span class="p">,</span> <span class="n">maxValidationAccSoFar</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Method to start the MAML training</p>
</div>


                            </div>
                            <div id="MAMLHandler.test" class="classattr">
                                        <input id="MAMLHandler.test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">test</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">test_data</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dataloader</span><span class="o">.</span><span class="n">DataLoader</span>,</span><span class="param">	<span class="n">adapt_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MAMLHandler.test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MAMLHandler.test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MAMLHandler.test-435"><a href="#MAMLHandler.test-435"><span class="linenos">435</span></a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_data</span><span class="p">:</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">adapt_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MAMLHandler.test-436"><a href="#MAMLHandler.test-436"><span class="linenos">436</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Check performance on test data</span>
</span><span id="MAMLHandler.test-437"><a href="#MAMLHandler.test-437"><span class="linenos">437</span></a>
</span><span id="MAMLHandler.test-438"><a href="#MAMLHandler.test-438"><span class="linenos">438</span></a><span class="sd">        Parameters</span>
</span><span id="MAMLHandler.test-439"><a href="#MAMLHandler.test-439"><span class="linenos">439</span></a><span class="sd">        ----------</span>
</span><span id="MAMLHandler.test-440"><a href="#MAMLHandler.test-440"><span class="linenos">440</span></a><span class="sd">        test_data : DataLoader</span>
</span><span id="MAMLHandler.test-441"><a href="#MAMLHandler.test-441"><span class="linenos">441</span></a><span class="sd">            The test data</span>
</span><span id="MAMLHandler.test-442"><a href="#MAMLHandler.test-442"><span class="linenos">442</span></a><span class="sd">        adapt_steps : int, optional</span>
</span><span id="MAMLHandler.test-443"><a href="#MAMLHandler.test-443"><span class="linenos">443</span></a><span class="sd">            Number of steps for adaptation. If None then same as that in validation, by default None</span>
</span><span id="MAMLHandler.test-444"><a href="#MAMLHandler.test-444"><span class="linenos">444</span></a>
</span><span id="MAMLHandler.test-445"><a href="#MAMLHandler.test-445"><span class="linenos">445</span></a><span class="sd">        Returns</span>
</span><span id="MAMLHandler.test-446"><a href="#MAMLHandler.test-446"><span class="linenos">446</span></a><span class="sd">        -------</span>
</span><span id="MAMLHandler.test-447"><a href="#MAMLHandler.test-447"><span class="linenos">447</span></a><span class="sd">        tuple</span>
</span><span id="MAMLHandler.test-448"><a href="#MAMLHandler.test-448"><span class="linenos">448</span></a><span class="sd">            Tuple containing test accuracies and training accuracies during finetuning at  each</span>
</span><span id="MAMLHandler.test-449"><a href="#MAMLHandler.test-449"><span class="linenos">449</span></a><span class="sd">            iteration. Both the elements of the tuple is a list. Also the accuracies are avreaged</span>
</span><span id="MAMLHandler.test-450"><a href="#MAMLHandler.test-450"><span class="linenos">450</span></a><span class="sd">            over all the provided subjects.</span>
</span><span id="MAMLHandler.test-451"><a href="#MAMLHandler.test-451"><span class="linenos">451</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MAMLHandler.test-452"><a href="#MAMLHandler.test-452"><span class="linenos">452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelSaveDir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span> <span class="o">+</span> <span class="s2">&quot;.pt&quot;</span><span class="p">),</span> <span class="n">map_location</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="MAMLHandler.test-453"><a href="#MAMLHandler.test-453"><span class="linenos">453</span></a>        <span class="n">adapt_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsInInnerLoopValid</span> <span class="k">if</span> <span class="n">adapt_steps</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">adapt_steps</span>
</span><span id="MAMLHandler.test-454"><a href="#MAMLHandler.test-454"><span class="linenos">454</span></a>        <span class="n">acc_all_finetune</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MAMLHandler.test-455"><a href="#MAMLHandler.test-455"><span class="linenos">455</span></a>        <span class="n">acc_all_test</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MAMLHandler.test-456"><a href="#MAMLHandler.test-456"><span class="linenos">456</span></a>        <span class="k">for</span> <span class="n">metaStep</span><span class="p">,</span> <span class="p">(</span><span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_data</span><span class="p">):</span>
</span><span id="MAMLHandler.test-457"><a href="#MAMLHandler.test-457"><span class="linenos">457</span></a>                <span class="n">X_support</span> <span class="o">=</span> <span class="n">X_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler.test-458"><a href="#MAMLHandler.test-458"><span class="linenos">458</span></a>                <span class="n">y_support</span> <span class="o">=</span> <span class="n">y_support</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler.test-459"><a href="#MAMLHandler.test-459"><span class="linenos">459</span></a>                <span class="n">X_query</span> <span class="o">=</span> <span class="n">X_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler.test-460"><a href="#MAMLHandler.test-460"><span class="linenos">460</span></a>                <span class="n">y_query</span> <span class="o">=</span> <span class="n">y_query</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="MAMLHandler.test-461"><a href="#MAMLHandler.test-461"><span class="linenos">461</span></a>
</span><span id="MAMLHandler.test-462"><a href="#MAMLHandler.test-462"><span class="linenos">462</span></a>                <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__performAction</span><span class="p">(</span>
</span><span id="MAMLHandler.test-463"><a href="#MAMLHandler.test-463"><span class="linenos">463</span></a>                    <span class="n">constants</span><span class="o">.</span><span class="n">VAL</span><span class="p">,</span> <span class="n">X_support</span><span class="p">,</span> <span class="n">y_support</span><span class="p">,</span> <span class="n">X_query</span><span class="p">,</span> <span class="n">y_query</span><span class="p">,</span> <span class="n">adapt_steps</span><span class="p">,</span> <span class="kc">True</span>
</span><span id="MAMLHandler.test-464"><a href="#MAMLHandler.test-464"><span class="linenos">464</span></a>                <span class="p">)</span>
</span><span id="MAMLHandler.test-465"><a href="#MAMLHandler.test-465"><span class="linenos">465</span></a>                <span class="n">acc_all_test</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MAMLHandler.test-466"><a href="#MAMLHandler.test-466"><span class="linenos">466</span></a>                <span class="n">acc_all_finetune</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="MAMLHandler.test-467"><a href="#MAMLHandler.test-467"><span class="linenos">467</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_all_test</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">acc_all_finetune</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Check performance on test data</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>test_data</strong> (DataLoader):
The test data</li>
<li><strong>adapt_steps</strong> (int, optional):
Number of steps for adaptation. If None then same as that in validation, by default None</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple</strong>: Tuple containing test accuracies and training accuracies during finetuning at  each
iteration. Both the elements of the tuple is a list. Also the accuracies are avreaged
over all the provided subjects.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>